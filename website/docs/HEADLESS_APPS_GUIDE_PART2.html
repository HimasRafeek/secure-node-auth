<!doctype html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Headless Apps Authentication Part 2 - Secure Node Auth</title>
    <meta name="description" content="Advanced headless authentication patterns including token refresh, protected routes, and state management. Part 2 of 3." />

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Headless Apps Authentication Part 2 - Secure Node Auth" />
    <meta property="og:description" content="Advanced headless authentication patterns including token refresh, protected routes, and state management. Part 2 of 3." />
    <meta property="og:site_name" content="Secure Node Auth" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Headless Apps Authentication Part 2 - Secure Node Auth" />
    <meta name="twitter:description" content="Advanced headless authentication patterns including token refresh, protected routes, and state management. Part 2 of 3." />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#667eea',
              secondary: '#764ba2',
            },
          },
        },
      };
    </script>

    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Highlight.js for code syntax highlighting -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell,
          sans-serif;
      }

      /* Sidebar styles */
      .sidebar {
        position: fixed;
        top: 64px;
        left: 0;
        bottom: 0;
        width: 280px;
        overflow-y: auto;
        background: #1a202c;
        border-right: 1px solid #2d3748;
        transition: transform 0.3s ease;
      }

      .sidebar::-webkit-scrollbar {
        width: 6px;
      }

      .sidebar::-webkit-scrollbar-track {
        background: #1a202c;
      }

      .sidebar::-webkit-scrollbar-thumb {
        background: #4a5568;
        border-radius: 3px;
      }

      .sidebar-hidden {
        transform: translateX(-100%);
      }

      .content-wrapper {
        margin-left: 280px;
        transition: margin-left 0.3s ease;
      }

      .content-wrapper.expanded {
        margin-left: 0;
      }

      /* TOC styles */
      .toc-item {
        padding: 0.5rem 1rem;
        cursor: pointer;
        transition: all 0.2s;
        border-left: 3px solid transparent;
      }

      .toc-item:hover {
        background: #2d3748;
        border-left-color: #667eea;
      }

      .toc-item.active {
        background: #2d3748;
        border-left-color: #667eea;
        color: #667eea;
      }

      .toc-h2 {
        font-size: 0.875rem;
        font-weight: 600;
      }

      .toc-h3 {
        font-size: 0.8rem;
        padding-left: 1.5rem;
        color: #a0aec0;
      }

      /* Markdown styles */
      .markdown-body {
        color: #e1e4e8;
        line-height: 1.8;
      }

      .markdown-body h1 {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid #667eea;
        scroll-margin-top: 80px;
      }

      .markdown-body h2 {
        font-size: 2rem;
        font-weight: bold;
        margin-top: 3rem;
        margin-bottom: 1rem;
        color: #667eea;
        scroll-margin-top: 80px;
      }

      .markdown-body h3 {
        font-size: 1.5rem;
        font-weight: bold;
        margin-top: 2rem;
        margin-bottom: 0.75rem;
        color: #8b9cdb;
        scroll-margin-top: 80px;
      }

      .markdown-body h4 {
        font-size: 1.25rem;
        font-weight: bold;
        margin-top: 1.5rem;
        margin-bottom: 0.5rem;
        color: #a0aec0;
      }

      .markdown-body p {
        margin-bottom: 1rem;
      }

      .markdown-body ul,
      .markdown-body ol {
        margin-bottom: 1rem;
        padding-left: 2rem;
      }

      .markdown-body li {
        margin-bottom: 0.5rem;
      }

      .markdown-body code {
        background: #1a1a2e;
        padding: 0.2rem 0.5rem;
        border-radius: 0.25rem;
        font-size: 0.9em;
        font-family: 'Consolas', 'Monaco', monospace;
      }

      .markdown-body pre {
        background: #1a1a2e;
        padding: 1.5rem;
        border-radius: 0.5rem;
        overflow-x: auto;
        margin: 1.5rem 0;
        border: 1px solid #2d3748;
      }

      .markdown-body pre code {
        background: transparent;
        padding: 0;
      }

      .markdown-body a {
        color: #667eea;
        text-decoration: none;
        transition: color 0.2s;
      }

      .markdown-body a:hover {
        color: #8b9cdb;
        text-decoration: underline;
      }

      .markdown-body blockquote {
        border-left: 4px solid #667eea;
        padding-left: 1rem;
        margin: 1.5rem 0;
        color: #a0aec0;
        background: #1a202c;
        padding: 1rem;
        border-radius: 0.25rem;
      }

      .markdown-body table {
        width: 100%;
        margin: 1.5rem 0;
        border-collapse: collapse;
      }

      .markdown-body th,
      .markdown-body td {
        border: 1px solid #4a5568;
        padding: 0.75rem;
        text-align: left;
      }

      .markdown-body th {
        background: #2d3748;
        font-weight: bold;
        color: #667eea;
      }

      .markdown-body tr:hover {
        background: #1a202c;
      }

      .markdown-body img {
        max-width: 100%;
        height: auto;
        border-radius: 0.5rem;
        margin: 1.5rem 0;
      }

      .markdown-body hr {
        border: none;
        border-top: 2px solid #2d3748;
        margin: 2rem 0;
      }

      /* Navigation buttons */
      .nav-button {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 0.5rem;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s;
      }

      .nav-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      .nav-button-outline {
        background: transparent;
        border: 2px solid #667eea;
        color: #667eea;
      }

      .nav-button-outline:hover {
        background: #667eea;
        color: white;
      }

      /* Mobile styles */
      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.mobile-open {
          transform: translateX(0);
          z-index: 40;
        }

        .content-wrapper {
          margin-left: 0;
        }
      }
    </style>
  </head>
  <body class="bg-gray-900 text-white">
    <!-- Top Navigation -->
    <nav
      class="fixed w-full top-0 z-50 bg-gray-900 border-b border-gray-800 backdrop-blur-lg bg-opacity-95"
    >
      <div class="px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <div class="flex items-center gap-4">
            <button
              id="sidebar-toggle"
              class="text-2xl text-gray-300 hover:text-primary transition"
            >
              <i class="fas fa-bars"></i>
            </button>
            <a href="/" class="flex items-center space-x-2">
              <i class="fas fa-shield-alt text-primary text-2xl"></i>
              <span class="text-xl font-bold">SecureNodeAuth</span>
            </a>
          </div>
          <div class="flex items-center gap-4">
            <a
              href="/"
              class="flex items-center gap-2 text-gray-300 hover:text-primary transition"
            >
              <i class="fas fa-home"></i>
              <span>Home</span>
            </a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Sidebar with TOC -->
    <aside id="sidebar" class="sidebar">
      <div class="p-4">
        <h3 class="text-sm font-bold text-gray-400 uppercase mb-2">Table of Contents</h3>
        <div id="toc" class="space-y-1">
    <div class="toc-item toc-h1" data-target="heading-0">
      Headless Apps Guide - Part 2
    </div>
    <div class="toc-item toc-h2" data-target="heading-1">
      Category, Account, and Budget Routes + Frontend Integration
    </div>
    <div class="toc-item toc-h3" data-target="heading-2">
      6. Category Routes (src/routes/categories.js)
    </div>
    <div class="toc-item toc-h3" data-target="heading-3">
      7. Account Routes (src/routes/accounts.js)
    </div>
    <div class="toc-item toc-h3" data-target="heading-4">
      8. Budget Routes (src/routes/budgets.js)
    </div>
    <div class="toc-item toc-h2" data-target="heading-5">
      Frontend Integration
    </div>
    <div class="toc-item toc-h3" data-target="heading-6">
      9. React Frontend Example
    </div></div>
      </div>
    </aside>

    <!-- Main Content -->
    <div id="content-wrapper" class="content-wrapper pt-20 pb-12 px-4 sm:px-6 lg:px-8">
      <div class="max-w-4xl mx-auto">
        <!-- Markdown Content (Server-rendered for SEO) -->
        <div id="content" class="markdown-body"><h1 id="heading-0">Headless Apps Guide - Part 2</h1><h2 id="heading-1">Category, Account, and Budget Routes + Frontend Integration</h2><h3 id="heading-2">6. Category Routes (src/routes/categories.js)</h3><pre><code class="language-javascript">const express = require(&#39;express&#39;);
const router = express.Router();

// Get all categories
router.get(&#39;/&#39;, async (req, res) =&gt; {
  try {
    const userId = req.user.userId;
    const { type } = req.query; // Filter by &#39;income&#39; or &#39;expense&#39;
    const pool = req.app.get(&#39;dbPool&#39;);
    
    let query = &#39;SELECT * FROM categories WHERE userId = ? AND isActive = TRUE&#39;;
    const params = [userId];
    
    if (type) {
      query += &#39; AND type = ?&#39;;
      params.push(type);
    }
    
    query += &#39; ORDER BY name ASC&#39;;
    
    const [categories] = await pool.execute(query, params);
    
    res.json({
      success: true,
      data: categories
    });
  } catch (error) {
    console.error(&#39;Get categories error:&#39;, error);
    res.status(500).json({
      success: false,
      error: &#39;Failed to fetch categories&#39;
    });
  }
});

// Create category
router.post(&#39;/&#39;, async (req, res) =&gt; {
  try {
    const userId = req.user.userId;
    const { name, type, color, icon } = req.body;
    const pool = req.app.get(&#39;dbPool&#39;);
    
    if (!name || !type) {
      return res.status(400).json({
        success: false,
        error: &#39;Name and type are required&#39;
      });
    }
    
    const [result] = await pool.execute(`
      INSERT INTO categories (userId, name, type, color, icon)
      VALUES (?, ?, ?, ?, ?)
    `, [userId, name, type, color || &#39;#000000&#39;, icon || null]);
    
    const [newCategory] = await pool.execute(
      &#39;SELECT * FROM categories WHERE id = ?&#39;,
      [result.insertId]
    );
    
    res.status(201).json({
      success: true,
      message: &#39;Category created successfully&#39;,
      data: newCategory[0]
    });
  } catch (error) {
    console.error(&#39;Create category error:&#39;, error);
    res.status(500).json({
      success: false,
      error: &#39;Failed to create category&#39;
    });
  }
});

// Update category
router.put(&#39;/:id&#39;, async (req, res) =&gt; {
  try {
    const userId = req.user.userId;
    const { id } = req.params;
    const { name, type, color, icon } = req.body;
    const pool = req.app.get(&#39;dbPool&#39;);
    
    const [result] = await pool.execute(`
      UPDATE categories 
      SET name = ?, type = ?, color = ?, icon = ?
      WHERE id = ? AND userId = ?
    `, [name, type, color, icon, id, userId]);
    
    if (result.affectedRows === 0) {
      return res.status(404).json({
        success: false,
        error: &#39;Category not found&#39;
      });
    }
    
    const [updated] = await pool.execute(
      &#39;SELECT * FROM categories WHERE id = ?&#39;,
      [id]
    );
    
    res.json({
      success: true,
      message: &#39;Category updated successfully&#39;,
      data: updated[0]
    });
  } catch (error) {
    console.error(&#39;Update category error:&#39;, error);
    res.status(500).json({
      success: false,
      error: &#39;Failed to update category&#39;
    });
  }
});

// Delete category (soft delete)
router.delete(&#39;/:id&#39;, async (req, res) =&gt; {
  try {
    const userId = req.user.userId;
    const { id } = req.params;
    const pool = req.app.get(&#39;dbPool&#39;);
    
    // Check if category has transactions
    const [transactions] = await pool.execute(
      &#39;SELECT COUNT(*) as count FROM transactions WHERE categoryId = ? AND userId = ?&#39;,
      [id, userId]
    );
    
    if (transactions[0].count &gt; 0) {
      // Soft delete (mark inactive)
      await pool.execute(
        &#39;UPDATE categories SET isActive = FALSE WHERE id = ? AND userId = ?&#39;,
        [id, userId]
      );
      
      return res.json({
        success: true,
        message: &#39;Category deactivated (has existing transactions)&#39;
      });
    }
    
    // Hard delete if no transactions
    const [result] = await pool.execute(
      &#39;DELETE FROM categories WHERE id = ? AND userId = ?&#39;,
      [id, userId]
    );
    
    if (result.affectedRows === 0) {
      return res.status(404).json({
        success: false,
        error: &#39;Category not found&#39;
      });
    }
    
    res.json({
      success: true,
      message: &#39;Category deleted successfully&#39;
    });
  } catch (error) {
    console.error(&#39;Delete category error:&#39;, error);
    res.status(500).json({
      success: false,
      error: &#39;Failed to delete category&#39;
    });
  }
});

module.exports = router;
</code></pre>
<h3 id="heading-3">7. Account Routes (src/routes/accounts.js)</h3><pre><code class="language-javascript">const express = require(&#39;express&#39;);
const router = express.Router();

// Get all accounts
router.get(&#39;/&#39;, async (req, res) =&gt; {
  try {
    const userId = req.user.userId;
    const pool = req.app.get(&#39;dbPool&#39;);
    
    const [accounts] = await pool.execute(`
      SELECT 
        a.*,
        COUNT(t.id) as transactionCount,
        SUM(CASE WHEN t.type = &#39;income&#39; THEN t.amount ELSE 0 END) as totalIncome,
        SUM(CASE WHEN t.type = &#39;expense&#39; THEN t.amount ELSE 0 END) as totalExpenses
      FROM accounts a
      LEFT JOIN transactions t ON a.id = t.accountId
      WHERE a.userId = ? AND a.isActive = TRUE
      GROUP BY a.id
      ORDER BY a.name ASC
    `, [userId]);
    
    res.json({
      success: true,
      data: accounts
    });
  } catch (error) {
    console.error(&#39;Get accounts error:&#39;, error);
    res.status(500).json({
      success: false,
      error: &#39;Failed to fetch accounts&#39;
    });
  }
});

// Create account
router.post(&#39;/&#39;, async (req, res) =&gt; {
  try {
    const userId = req.user.userId;
    const { name, type, balance = 0, currency = &#39;USD&#39; } = req.body;
    const pool = req.app.get(&#39;dbPool&#39;);
    
    if (!name || !type) {
      return res.status(400).json({
        success: false,
        error: &#39;Name and type are required&#39;
      });
    }
    
    const [result] = await pool.execute(`
      INSERT INTO accounts (userId, name, type, balance, currency)
      VALUES (?, ?, ?, ?, ?)
    `, [userId, name, type, balance, currency]);
    
    const [newAccount] = await pool.execute(
      &#39;SELECT * FROM accounts WHERE id = ?&#39;,
      [result.insertId]
    );
    
    res.status(201).json({
      success: true,
      message: &#39;Account created successfully&#39;,
      data: newAccount[0]
    });
  } catch (error) {
    console.error(&#39;Create account error:&#39;, error);
    res.status(500).json({
      success: false,
      error: &#39;Failed to create account&#39;
    });
  }
});

// Update account
router.put(&#39;/:id&#39;, async (req, res) =&gt; {
  try {
    const userId = req.user.userId;
    const { id } = req.params;
    const { name, type, currency } = req.body;
    const pool = req.app.get(&#39;dbPool&#39;);
    
    const [result] = await pool.execute(`
      UPDATE accounts 
      SET name = ?, type = ?, currency = ?
      WHERE id = ? AND userId = ?
    `, [name, type, currency, id, userId]);
    
    if (result.affectedRows === 0) {
      return res.status(404).json({
        success: false,
        error: &#39;Account not found&#39;
      });
    }
    
    const [updated] = await pool.execute(
      &#39;SELECT * FROM accounts WHERE id = ?&#39;,
      [id]
    );
    
    res.json({
      success: true,
      message: &#39;Account updated successfully&#39;,
      data: updated[0]
    });
  } catch (error) {
    console.error(&#39;Update account error:&#39;, error);
    res.status(500).json({
      success: false,
      error: &#39;Failed to update account&#39;
    });
  }
});

// Delete account
router.delete(&#39;/:id&#39;, async (req, res) =&gt; {
  try {
    const userId = req.user.userId;
    const { id } = req.params;
    const pool = req.app.get(&#39;dbPool&#39;);
    
    // Check if account has transactions
    const [transactions] = await pool.execute(
      &#39;SELECT COUNT(*) as count FROM transactions WHERE accountId = ? AND userId = ?&#39;,
      [id, userId]
    );
    
    if (transactions[0].count &gt; 0) {
      // Soft delete
      await pool.execute(
        &#39;UPDATE accounts SET isActive = FALSE WHERE id = ? AND userId = ?&#39;,
        [id, userId]
      );
      
      return res.json({
        success: true,
        message: &#39;Account deactivated (has existing transactions)&#39;
      });
    }
    
    // Hard delete
    const [result] = await pool.execute(
      &#39;DELETE FROM accounts WHERE id = ? AND userId = ?&#39;,
      [id, userId]
    );
    
    if (result.affectedRows === 0) {
      return res.status(404).json({
        success: false,
        error: &#39;Account not found&#39;
      });
    }
    
    res.json({
      success: true,
      message: &#39;Account deleted successfully&#39;
    });
  } catch (error) {
    console.error(&#39;Delete account error:&#39;, error);
    res.status(500).json({
      success: false,
      error: &#39;Failed to delete account&#39;
    });
  }
});

module.exports = router;
</code></pre>
<h3 id="heading-4">8. Budget Routes (src/routes/budgets.js)</h3><pre><code class="language-javascript">const express = require(&#39;express&#39;);
const router = express.Router();

// Get all budgets with spending
router.get(&#39;/&#39;, async (req, res) =&gt; {
  try {
    const userId = req.user.userId;
    const { period = &#39;monthly&#39; } = req.query;
    const pool = req.app.get(&#39;dbPool&#39;);
    
    const [budgets] = await pool.execute(`
      SELECT 
        b.*,
        c.name as categoryName,
        c.color as categoryColor,
        c.icon as categoryIcon,
        COALESCE(SUM(t.amount), 0) as spent
      FROM budgets b
      JOIN categories c ON b.categoryId = c.id
      LEFT JOIN transactions t ON t.categoryId = b.categoryId 
        AND t.userId = b.userId 
        AND t.type = &#39;expense&#39;
        AND t.transactionDate &gt;= b.startDate
        AND (b.endDate IS NULL OR t.transactionDate &lt;= b.endDate)
      WHERE b.userId = ? AND b.period = ?
      GROUP BY b.id
      ORDER BY b.createdAt DESC
    `, [userId, period]);
    
    // Calculate percentage and status for each budget
    const budgetsWithStatus = budgets.map(budget =&gt; ({
      ...budget,
      spent: parseFloat(budget.spent),
      amount: parseFloat(budget.amount),
      percentage: (parseFloat(budget.spent) / parseFloat(budget.amount)) * 100,
      remaining: parseFloat(budget.amount) - parseFloat(budget.spent),
      status: parseFloat(budget.spent) &gt;= parseFloat(budget.amount) 
        ? &#39;exceeded&#39; 
        : parseFloat(budget.spent) &gt;= (parseFloat(budget.amount) * budget.alertThreshold / 100)
          ? &#39;warning&#39;
          : &#39;good&#39;
    }));
    
    res.json({
      success: true,
      data: budgetsWithStatus
    });
  } catch (error) {
    console.error(&#39;Get budgets error:&#39;, error);
    res.status(500).json({
      success: false,
      error: &#39;Failed to fetch budgets&#39;
    });
  }
});

// Create budget
router.post(&#39;/&#39;, async (req, res) =&gt; {
  try {
    const userId = req.user.userId;
    const { categoryId, amount, period, startDate, endDate, alertThreshold } = req.body;
    const pool = req.app.get(&#39;dbPool&#39;);
    
    if (!categoryId || !amount || !period || !startDate) {
      return res.status(400).json({
        success: false,
        error: &#39;CategoryId, amount, period, and startDate are required&#39;
      });
    }
    
    // Verify category belongs to user
    const [categories] = await pool.execute(
      &#39;SELECT id FROM categories WHERE id = ? AND userId = ?&#39;,
      [categoryId, userId]
    );
    
    if (categories.length === 0) {
      return res.status(403).json({
        success: false,
        error: &#39;Category not found or access denied&#39;
      });
    }
    
    const [result] = await pool.execute(`
      INSERT INTO budgets 
      (userId, categoryId, amount, period, startDate, endDate, alertThreshold)
      VALUES (?, ?, ?, ?, ?, ?, ?)
    `, [userId, categoryId, amount, period, startDate, endDate || null, alertThreshold || 80]);
    
    const [newBudget] = await pool.execute(`
      SELECT 
        b.*,
        c.name as categoryName,
        c.color as categoryColor
      FROM budgets b
      JOIN categories c ON b.categoryId = c.id
      WHERE b.id = ?
    `, [result.insertId]);
    
    res.status(201).json({
      success: true,
      message: &#39;Budget created successfully&#39;,
      data: newBudget[0]
    });
  } catch (error) {
    if (error.code === &#39;ER_DUP_ENTRY&#39;) {
      return res.status(409).json({
        success: false,
        error: &#39;Budget already exists for this category and period&#39;
      });
    }
    console.error(&#39;Create budget error:&#39;, error);
    res.status(500).json({
      success: false,
      error: &#39;Failed to create budget&#39;
    });
  }
});

// Update budget
router.put(&#39;/:id&#39;, async (req, res) =&gt; {
  try {
    const userId = req.user.userId;
    const { id } = req.params;
    const { amount, endDate, alertThreshold } = req.body;
    const pool = req.app.get(&#39;dbPool&#39;);
    
    const [result] = await pool.execute(`
      UPDATE budgets 
      SET amount = ?, endDate = ?, alertThreshold = ?
      WHERE id = ? AND userId = ?
    `, [amount, endDate, alertThreshold, id, userId]);
    
    if (result.affectedRows === 0) {
      return res.status(404).json({
        success: false,
        error: &#39;Budget not found&#39;
      });
    }
    
    const [updated] = await pool.execute(`
      SELECT 
        b.*,
        c.name as categoryName,
        c.color as categoryColor
      FROM budgets b
      JOIN categories c ON b.categoryId = c.id
      WHERE b.id = ?
    `, [id]);
    
    res.json({
      success: true,
      message: &#39;Budget updated successfully&#39;,
      data: updated[0]
    });
  } catch (error) {
    console.error(&#39;Update budget error:&#39;, error);
    res.status(500).json({
      success: false,
      error: &#39;Failed to update budget&#39;
    });
  }
});

// Delete budget
router.delete(&#39;/:id&#39;, async (req, res) =&gt; {
  try {
    const userId = req.user.userId;
    const { id } = req.params;
    const pool = req.app.get(&#39;dbPool&#39;);
    
    const [result] = await pool.execute(
      &#39;DELETE FROM budgets WHERE id = ? AND userId = ?&#39;,
      [id, userId]
    );
    
    if (result.affectedRows === 0) {
      return res.status(404).json({
        success: false,
        error: &#39;Budget not found&#39;
      });
    }
    
    res.json({
      success: true,
      message: &#39;Budget deleted successfully&#39;
    });
  } catch (error) {
    console.error(&#39;Delete budget error:&#39;, error);
    res.status(500).json({
      success: false,
      error: &#39;Failed to delete budget&#39;
    });
  }
});

module.exports = router;
</code></pre>
<hr>
<h2 id="heading-5">Frontend Integration</h2><h3 id="heading-6">9. React Frontend Example</h3><h4 id="heading-7">Install Dependencies</h4><pre><code class="language-bash">npx create-react-app expense-tracker-client
cd expense-tracker-client
npm install axios react-router-dom date-fns recharts
</code></pre>
<h4 id="heading-8">API Service (src/services/api.js)</h4><pre><code class="language-javascript">import axios from &#39;axios&#39;;

const API_BASE_URL = process.env.REACT_APP_API_URL || &#39;http://localhost:3000/api&#39;;

// Create axios instance
const api = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    &#39;Content-Type&#39;: &#39;application/json&#39;,
  },
});

// Request interceptor to add token
api.interceptors.request.use(
  (config) =&gt; {
    const token = localStorage.getItem(&#39;accessToken&#39;);
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) =&gt; {
    return Promise.reject(error);
  }
);

// Response interceptor to handle token refresh
api.interceptors.response.use(
  (response) =&gt; response,
  async (error) =&gt; {
    const originalRequest = error.config;

    // If token expired, try to refresh
    if (error.response?.status === 401 &amp;&amp; !originalRequest._retry) {
      originalRequest._retry = true;

      try {
        const refreshToken = localStorage.getItem(&#39;refreshToken&#39;);
        const response = await axios.post(`${API_BASE_URL}/auth/refresh`, {
          refreshToken,
        });

        const { accessToken } = response.data.data;
        localStorage.setItem(&#39;accessToken&#39;, accessToken);

        // Retry original request with new token
        originalRequest.headers.Authorization = `Bearer ${accessToken}`;
        return api(originalRequest);
      } catch (refreshError) {
        // Refresh failed, logout user
        localStorage.removeItem(&#39;accessToken&#39;);
        localStorage.removeItem(&#39;refreshToken&#39;);
        window.location.href = &#39;/login&#39;;
        return Promise.reject(refreshError);
      }
    }

    return Promise.reject(error);
  }
);

// Auth API
export const authAPI = {
  register: async (userData) =&gt; {
    const response = await api.post(&#39;/auth/register&#39;, userData);
    return response.data;
  },
  
  login: async (email, password) =&gt; {
    const response = await api.post(&#39;/auth/login&#39;, { email, password });
    const { user, tokens } = response.data.data;
    
    // Store tokens
    localStorage.setItem(&#39;accessToken&#39;, tokens.accessToken);
    localStorage.setItem(&#39;refreshToken&#39;, tokens.refreshToken);
    localStorage.setItem(&#39;user&#39;, JSON.stringify(user));
    
    return response.data;
  },
  
  logout: async () =&gt; {
    const refreshToken = localStorage.getItem(&#39;refreshToken&#39;);
    await api.post(&#39;/auth/logout&#39;, { refreshToken });
    
    // Clear storage
    localStorage.removeItem(&#39;accessToken&#39;);
    localStorage.removeItem(&#39;refreshToken&#39;);
    localStorage.removeItem(&#39;user&#39;);
  },
  
  getCurrentUser: async () =&gt; {
    const response = await api.get(&#39;/auth/me&#39;);
    return response.data;
  },
  
  completeSetup: async () =&gt; {
    const response = await api.post(&#39;/auth/register-complete&#39;);
    return response.data;
  }
};

// Transaction API
export const transactionAPI = {
  getAll: async (params = {}) =&gt; {
    const response = await api.get(&#39;/transactions&#39;, { params });
    return response.data;
  },
  
  getById: async (id) =&gt; {
    const response = await api.get(`/transactions/${id}`);
    return response.data;
  },
  
  create: async (transactionData) =&gt; {
    const response = await api.post(&#39;/transactions&#39;, transactionData);
    return response.data;
  },
  
  update: async (id, transactionData) =&gt; {
    const response = await api.put(`/transactions/${id}`, transactionData);
    return response.data;
  },
  
  delete: async (id) =&gt; {
    const response = await api.delete(`/transactions/${id}`);
    return response.data;
  },
  
  getSummary: async (params = {}) =&gt; {
    const response = await api.get(&#39;/transactions/summary/stats&#39;, { params });
    return response.data;
  }
};

// Category API
export const categoryAPI = {
  getAll: async (type) =&gt; {
    const response = await api.get(&#39;/categories&#39;, { params: { type } });
    return response.data;
  },
  
  create: async (categoryData) =&gt; {
    const response = await api.post(&#39;/categories&#39;, categoryData);
    return response.data;
  },
  
  update: async (id, categoryData) =&gt; {
    const response = await api.put(`/categories/${id}`, categoryData);
    return response.data;
  },
  
  delete: async (id) =&gt; {
    const response = await api.delete(`/categories/${id}`);
    return response.data;
  }
};

// Account API
export const accountAPI = {
  getAll: async () =&gt; {
    const response = await api.get(&#39;/accounts&#39;);
    return response.data;
  },
  
  create: async (accountData) =&gt; {
    const response = await api.post(&#39;/accounts&#39;, accountData);
    return response.data;
  },
  
  update: async (id, accountData) =&gt; {
    const response = await api.put(`/accounts/${id}`, accountData);
    return response.data;
  },
  
  delete: async (id) =&gt; {
    const response = await api.delete(`/accounts/${id}`);
    return response.data;
  }
};

// Budget API
export const budgetAPI = {
  getAll: async (period) =&gt; {
    const response = await api.get(&#39;/budgets&#39;, { params: { period } });
    return response.data;
  },
  
  create: async (budgetData) =&gt; {
    const response = await api.post(&#39;/budgets&#39;, budgetData);
    return response.data;
  },
  
  update: async (id, budgetData) =&gt; {
    const response = await api.put(`/budgets/${id}`, budgetData);
    return response.data;
  },
  
  delete: async (id) =&gt; {
    const response = await api.delete(`/budgets/${id}`);
    return response.data;
  }
};

export default api;
</code></pre>
<h4 id="heading-9">Auth Context (src/context/AuthContext.js)</h4><pre><code class="language-javascript">import React, { createContext, useState, useContext, useEffect } from &#39;react&#39;;
import { authAPI } from &#39;../services/api&#39;;

const AuthContext = createContext();

export const useAuth = () =&gt; {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error(&#39;useAuth must be used within AuthProvider&#39;);
  }
  return context;
};

export const AuthProvider = ({ children }) =&gt; {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [isAuthenticated, setIsAuthenticated] = useState(false);

  useEffect(() =&gt; {
    // Check if user is logged in
    const storedUser = localStorage.getItem(&#39;user&#39;);
    const accessToken = localStorage.getItem(&#39;accessToken&#39;);

    if (storedUser &amp;&amp; accessToken) {
      setUser(JSON.parse(storedUser));
      setIsAuthenticated(true);
    }
    setLoading(false);
  }, []);

  const login = async (email, password) =&gt; {
    try {
      const response = await authAPI.login(email, password);
      setUser(response.data.user);
      setIsAuthenticated(true);
      return response;
    } catch (error) {
      throw error;
    }
  };

  const register = async (userData) =&gt; {
    try {
      const response = await authAPI.register(userData);
      setUser(response.data.user);
      setIsAuthenticated(true);
      
      // Complete setup
      await authAPI.completeSetup();
      
      return response;
    } catch (error) {
      throw error;
    }
  };

  const logout = async () =&gt; {
    try {
      await authAPI.logout();
    } catch (error) {
      console.error(&#39;Logout error:&#39;, error);
    } finally {
      setUser(null);
      setIsAuthenticated(false);
    }
  };

  const value = {
    user,
    loading,
    isAuthenticated,
    login,
    register,
    logout,
  };

  return &lt;AuthContext.Provider value={value}&gt;{children}&lt;/AuthContext.Provider&gt;;
};
</code></pre>
<h4 id="heading-10">Protected Route Component (src/components/ProtectedRoute.js)</h4><pre><code class="language-javascript">import React from &#39;react&#39;;
import { Navigate } from &#39;react-router-dom&#39;;
import { useAuth } from &#39;../context/AuthContext&#39;;

const ProtectedRoute = ({ children }) =&gt; {
  const { isAuthenticated, loading } = useAuth();

  if (loading) {
    return &lt;div&gt;Loading...&lt;/div&gt;;
  }

  if (!isAuthenticated) {
    return &lt;Navigate to=&quot;/login&quot; replace /&gt;;
  }

  return children;
};

export default ProtectedRoute;
</code></pre>
<h4 id="heading-11">Dashboard Component (src/pages/Dashboard.js)</h4><pre><code class="language-javascript">import React, { useState, useEffect } from &#39;react&#39;;
import { transactionAPI, accountAPI } from &#39;../services/api&#39;;
import { useAuth } from &#39;../context/AuthContext&#39;;

const Dashboard = () =&gt; {
  const { user } = useAuth();
  const [summary, setSummary] = useState(null);
  const [accounts, setAccounts] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() =&gt; {
    fetchDashboardData();
  }, []);

  const fetchDashboardData = async () =&gt; {
    try {
      setLoading(true);
      
      // Fetch summary statistics
      const summaryResponse = await transactionAPI.getSummary({ period: &#39;month&#39; });
      setSummary(summaryResponse.data);
      
      // Fetch accounts
      const accountsResponse = await accountAPI.getAll();
      setAccounts(accountsResponse.data);
      
    } catch (error) {
      console.error(&#39;Failed to fetch dashboard data:&#39;, error);
    } finally {
      setLoading(false);
    }
  };

  if (loading) {
    return &lt;div className=&quot;loading&quot;&gt;Loading dashboard...&lt;/div&gt;;
  }

  return (
    &lt;div className=&quot;dashboard&quot;&gt;
      &lt;h1&gt;Welcome back, {user.firstName}!&lt;/h1&gt;
      
      {/* Summary Cards */}
      &lt;div className=&quot;summary-cards&quot;&gt;
        &lt;div className=&quot;card income&quot;&gt;
          &lt;h3&gt;Total Income&lt;/h3&gt;
          &lt;p className=&quot;amount&quot;&gt;${summary?.totals.income.toFixed(2)}&lt;/p&gt;
        &lt;/div&gt;
        
        &lt;div className=&quot;card expense&quot;&gt;
          &lt;h3&gt;Total Expenses&lt;/h3&gt;
          &lt;p className=&quot;amount&quot;&gt;${summary?.totals.expenses.toFixed(2)}&lt;/p&gt;
        &lt;/div&gt;
        
        &lt;div className=&quot;card balance&quot;&gt;
          &lt;h3&gt;Balance&lt;/h3&gt;
          &lt;p className=&quot;amount&quot;&gt;${summary?.totals.balance.toFixed(2)}&lt;/p&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      
      {/* Accounts */}
      &lt;div className=&quot;accounts-section&quot;&gt;
        &lt;h2&gt;Accounts&lt;/h2&gt;
        &lt;div className=&quot;accounts-grid&quot;&gt;
          {accounts.map(account =&gt; (
            &lt;div key={account.id} className=&quot;account-card&quot;&gt;
              &lt;h3&gt;{account.name}&lt;/h3&gt;
              &lt;p className=&quot;account-type&quot;&gt;{account.type}&lt;/p&gt;
              &lt;p className=&quot;balance&quot;&gt;${account.balance.toFixed(2)}&lt;/p&gt;
            &lt;/div&gt;
          ))}
        &lt;/div&gt;
      &lt;/div&gt;
      
      {/* Category Breakdown */}
      &lt;div className=&quot;category-breakdown&quot;&gt;
        &lt;h2&gt;Spending by Category&lt;/h2&gt;
        &lt;div className=&quot;category-list&quot;&gt;
          {summary?.byCategory.filter(cat =&gt; cat.type === &#39;expense&#39;).map(category =&gt; (
            &lt;div key={category.name} className=&quot;category-item&quot;&gt;
              &lt;div className=&quot;category-info&quot;&gt;
                &lt;span 
                  className=&quot;category-color&quot; 
                  style={{ backgroundColor: category.color }}
                /&gt;
                &lt;span className=&quot;category-name&quot;&gt;{category.name}&lt;/span&gt;
              &lt;/div&gt;
              &lt;span className=&quot;category-amount&quot;&gt;${category.total.toFixed(2)}&lt;/span&gt;
            &lt;/div&gt;
          ))}
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};

export default Dashboard;
</code></pre>
<p>Continue in Part 3...</p>
</div>

        <!-- Navigation Buttons -->
        <div id="doc-navigation" class="mt-12 pt-8 border-t-2 border-gray-800"><div class="flex flex-col sm:flex-row justify-between gap-4">
      <a href="HEADLESS_APPS_GUIDE.html" class="nav-button-outline">
        <i class="fas fa-arrow-left"></i>
        <span>Headless Apps (Part 1)</span>
      </a>
      <a href="HEADLESS_APPS_GUIDE_PART3.html" class="nav-button">
        <span>Headless Apps (Part 3)</span>
        <i class="fas fa-arrow-right"></i>
      </a></div></div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="../js/static-docs.js"></script>
  </body>
</html>
