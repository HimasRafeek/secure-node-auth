<!doctype html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Data Quick Reference - Secure Node Auth</title>
    <meta name="description" content="Quick reference guide for common patterns in accessing and managing user-specific data." />

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="article" />
    <meta property="og:title" content="User Data Quick Reference - Secure Node Auth" />
    <meta property="og:description" content="Quick reference guide for common patterns in accessing and managing user-specific data." />
    <meta property="og:site_name" content="Secure Node Auth" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="User Data Quick Reference - Secure Node Auth" />
    <meta name="twitter:description" content="Quick reference guide for common patterns in accessing and managing user-specific data." />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#667eea',
              secondary: '#764ba2',
            },
          },
        },
      };
    </script>

    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Highlight.js for code syntax highlighting -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell,
          sans-serif;
      }

      /* Sidebar styles */
      .sidebar {
        position: fixed;
        top: 64px;
        left: 0;
        bottom: 0;
        width: 280px;
        overflow-y: auto;
        background: #1a202c;
        border-right: 1px solid #2d3748;
        transition: transform 0.3s ease;
      }

      .sidebar::-webkit-scrollbar {
        width: 6px;
      }

      .sidebar::-webkit-scrollbar-track {
        background: #1a202c;
      }

      .sidebar::-webkit-scrollbar-thumb {
        background: #4a5568;
        border-radius: 3px;
      }

      .sidebar-hidden {
        transform: translateX(-100%);
      }

      .content-wrapper {
        margin-left: 280px;
        transition: margin-left 0.3s ease;
      }

      .content-wrapper.expanded {
        margin-left: 0;
      }

      /* TOC styles */
      .toc-item {
        padding: 0.5rem 1rem;
        cursor: pointer;
        transition: all 0.2s;
        border-left: 3px solid transparent;
      }

      .toc-item:hover {
        background: #2d3748;
        border-left-color: #667eea;
      }

      .toc-item.active {
        background: #2d3748;
        border-left-color: #667eea;
        color: #667eea;
      }

      .toc-h2 {
        font-size: 0.875rem;
        font-weight: 600;
      }

      .toc-h3 {
        font-size: 0.8rem;
        padding-left: 1.5rem;
        color: #a0aec0;
      }

      /* Markdown styles */
      .markdown-body {
        color: #e1e4e8;
        line-height: 1.8;
      }

      .markdown-body h1 {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid #667eea;
        scroll-margin-top: 80px;
      }

      .markdown-body h2 {
        font-size: 2rem;
        font-weight: bold;
        margin-top: 3rem;
        margin-bottom: 1rem;
        color: #667eea;
        scroll-margin-top: 80px;
      }

      .markdown-body h3 {
        font-size: 1.5rem;
        font-weight: bold;
        margin-top: 2rem;
        margin-bottom: 0.75rem;
        color: #8b9cdb;
        scroll-margin-top: 80px;
      }

      .markdown-body h4 {
        font-size: 1.25rem;
        font-weight: bold;
        margin-top: 1.5rem;
        margin-bottom: 0.5rem;
        color: #a0aec0;
      }

      .markdown-body p {
        margin-bottom: 1rem;
      }

      .markdown-body ul,
      .markdown-body ol {
        margin-bottom: 1rem;
        padding-left: 2rem;
      }

      .markdown-body li {
        margin-bottom: 0.5rem;
      }

      .markdown-body code {
        background: #1a1a2e;
        padding: 0.2rem 0.5rem;
        border-radius: 0.25rem;
        font-size: 0.9em;
        font-family: 'Consolas', 'Monaco', monospace;
      }

      .markdown-body pre {
        background: #1a1a2e;
        padding: 1.5rem;
        border-radius: 0.5rem;
        overflow-x: auto;
        margin: 1.5rem 0;
        border: 1px solid #2d3748;
      }

      .markdown-body pre code {
        background: transparent;
        padding: 0;
      }

      .markdown-body a {
        color: #667eea;
        text-decoration: none;
        transition: color 0.2s;
      }

      .markdown-body a:hover {
        color: #8b9cdb;
        text-decoration: underline;
      }

      .markdown-body blockquote {
        border-left: 4px solid #667eea;
        padding-left: 1rem;
        margin: 1.5rem 0;
        color: #a0aec0;
        background: #1a202c;
        padding: 1rem;
        border-radius: 0.25rem;
      }

      .markdown-body table {
        width: 100%;
        margin: 1.5rem 0;
        border-collapse: collapse;
      }

      .markdown-body th,
      .markdown-body td {
        border: 1px solid #4a5568;
        padding: 0.75rem;
        text-align: left;
      }

      .markdown-body th {
        background: #2d3748;
        font-weight: bold;
        color: #667eea;
      }

      .markdown-body tr:hover {
        background: #1a202c;
      }

      .markdown-body img {
        max-width: 100%;
        height: auto;
        border-radius: 0.5rem;
        margin: 1.5rem 0;
      }

      .markdown-body hr {
        border: none;
        border-top: 2px solid #2d3748;
        margin: 2rem 0;
      }

      /* Navigation buttons */
      .nav-button {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 0.5rem;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s;
      }

      .nav-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      .nav-button-outline {
        background: transparent;
        border: 2px solid #667eea;
        color: #667eea;
      }

      .nav-button-outline:hover {
        background: #667eea;
        color: white;
      }

      /* Mobile styles */
      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.mobile-open {
          transform: translateX(0);
          z-index: 40;
        }

        .content-wrapper {
          margin-left: 0;
        }
      }
    </style>
  </head>
  <body class="bg-gray-900 text-white">
    <!-- Top Navigation -->
    <nav
      class="fixed w-full top-0 z-50 bg-gray-900 border-b border-gray-800 backdrop-blur-lg bg-opacity-95"
    >
      <div class="px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <div class="flex items-center gap-4">
            <button
              id="sidebar-toggle"
              class="text-2xl text-gray-300 hover:text-primary transition"
            >
              <i class="fas fa-bars"></i>
            </button>
            <a href="/" class="flex items-center space-x-2">
              <i class="fas fa-shield-alt text-primary text-2xl"></i>
              <span class="text-xl font-bold">SecureNodeAuth</span>
            </a>
          </div>
          <div class="flex items-center gap-4">
            <a
              href="/"
              class="flex items-center gap-2 text-gray-300 hover:text-primary transition"
            >
              <i class="fas fa-home"></i>
              <span>Home</span>
            </a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Sidebar with TOC -->
    <aside id="sidebar" class="sidebar">
      <div class="p-4">
        <h3 class="text-sm font-bold text-gray-400 uppercase mb-2">Table of Contents</h3>
        <div id="toc" class="space-y-1">
    <div class="toc-item toc-h1" data-target="heading-0">
      üéØ Quick Reference: User Data Access
    </div>
    <div class="toc-item toc-h2" data-target="heading-1">
      The Essential Pattern
    </div>
    <div class="toc-item toc-h2" data-target="heading-2">
      Common Patterns Cheat Sheet
    </div>
    <div class="toc-item toc-h3" data-target="heading-3">
      üìñ Read (GET)
    </div>
    <div class="toc-item toc-h3" data-target="heading-4">
      ‚úèÔ∏è Create (POST)
    </div>
    <div class="toc-item toc-h3" data-target="heading-5">
      üîÑ Update (PATCH)
    </div>
    <div class="toc-item toc-h3" data-target="heading-6">
      üóëÔ∏è Delete (DELETE)
    </div>
    <div class="toc-item toc-h2" data-target="heading-7">
      What's in `req.user`?
    </div>
    <div class="toc-item toc-h2" data-target="heading-8">
      Security Checklist ‚úÖ
    </div>
    <div class="toc-item toc-h2" data-target="heading-9">
      Testing Flow
    </div>
    <div class="toc-item toc-h2" data-target="heading-10">
      Database Setup
    </div>
    <div class="toc-item toc-h2" data-target="heading-11">
      Common Mistakes ‚ùå
    </div>
    <div class="toc-item toc-h3" data-target="heading-12">
      Mistake 1: Not checking ownership
    </div>
    <div class="toc-item toc-h3" data-target="heading-13">
      Mistake 2: Trusting client-provided IDs
    </div>
    <div class="toc-item toc-h3" data-target="heading-14">
      Mistake 3: SQL injection
    </div>
    <div class="toc-item toc-h2" data-target="heading-15">
      Frontend Integration
    </div>
    <div class="toc-item toc-h2" data-target="heading-16">
      Quick Troubleshooting
    </div>
    <div class="toc-item toc-h2" data-target="heading-17">
      üéì Remember
    </div>
    <div class="toc-item toc-h2" data-target="heading-18">
      Need More Help?
    </div></div>
      </div>
    </aside>

    <!-- Main Content -->
    <div id="content-wrapper" class="content-wrapper pt-20 pb-12 px-4 sm:px-6 lg:px-8">
      <div class="max-w-4xl mx-auto">
        <!-- Markdown Content (Server-rendered for SEO) -->
        <div id="content" class="markdown-body"><h1 id="heading-0">üéØ Quick Reference: User Data Access</h1><h2 id="heading-1">The Essential Pattern</h2><pre><code class="language-javascript">app.get(&#39;/api/my-data&#39;, auth.middleware(), async (req, res) =&gt; {
  const userId = req.user.userId;  // üëà Get authenticated user&#39;s ID
  
  // Use userId to fetch only this user&#39;s data
  const [data] = await pool.execute(
    &#39;SELECT * FROM table WHERE userId = ?&#39;,
    [userId]
  );
  
  res.json({ data });
});
</code></pre>
<hr>
<h2 id="heading-2">Common Patterns Cheat Sheet</h2><h3 id="heading-3">üìñ Read (GET)</h3><pre><code class="language-javascript">// Get my posts
app.get(&#39;/api/posts/mine&#39;, auth.middleware(), async (req, res) =&gt; {
  const userId = req.user.userId;
  const [posts] = await pool.execute(
    &#39;SELECT * FROM posts WHERE userId = ?&#39;, [userId]
  );
  res.json({ posts });
});
</code></pre>
<h3 id="heading-4">‚úèÔ∏è Create (POST)</h3><pre><code class="language-javascript">// Create post
app.post(&#39;/api/posts&#39;, auth.middleware(), async (req, res) =&gt; {
  const userId = req.user.userId;
  const { title, content } = req.body;
  
  await pool.execute(
    &#39;INSERT INTO posts (userId, title, content) VALUES (?, ?, ?)&#39;,
    [userId, title, content]
  );
  
  res.json({ success: true });
});
</code></pre>
<h3 id="heading-5">üîÑ Update (PATCH)</h3><pre><code class="language-javascript">// Update my post
app.patch(&#39;/api/posts/:id&#39;, auth.middleware(), async (req, res) =&gt; {
  const userId = req.user.userId;
  const postId = req.params.id;
  
  // ‚ö†Ô∏è Important: Check ownership!
  const [result] = await pool.execute(
    &#39;UPDATE posts SET title = ? WHERE id = ? AND userId = ?&#39;,
    [req.body.title, postId, userId]
  );
  
  if (result.affectedRows === 0) {
    return res.status(404).json({ error: &#39;Not found or unauthorized&#39; });
  }
  
  res.json({ success: true });
});
</code></pre>
<h3 id="heading-6">üóëÔ∏è Delete (DELETE)</h3><pre><code class="language-javascript">// Delete my post
app.delete(&#39;/api/posts/:id&#39;, auth.middleware(), async (req, res) =&gt; {
  const userId = req.user.userId;
  const postId = req.params.id;
  
  // ‚ö†Ô∏è Important: Check ownership!
  const [result] = await pool.execute(
    &#39;DELETE FROM posts WHERE id = ? AND userId = ?&#39;,
    [postId, userId]
  );
  
  if (result.affectedRows === 0) {
    return res.status(404).json({ error: &#39;Not found or unauthorized&#39; });
  }
  
  res.json({ success: true });
});
</code></pre>
<hr>
<h2 id="heading-7">What's in `req.user`?</h2><pre><code class="language-javascript">req.user = {
  userId: 123,              // Database user ID
  email: &quot;user@example.com&quot;, // User email
  iat: 1699268400,          // Issued at (timestamp)
  exp: 1699269300           // Expires at (timestamp)
}
</code></pre>
<hr>
<h2 id="heading-8">Security Checklist ‚úÖ</h2><pre><code class="language-javascript">// ‚úÖ DO: Get user ID from token
const userId = req.user.userId;

// ‚ùå DON&#39;T: Get user ID from request body
const userId = req.body.userId; // Client can fake this!

// ‚úÖ DO: Always verify ownership
WHERE id = ? AND userId = ?

// ‚ùå DON&#39;T: Trust client without checking
WHERE id = ?  // Anyone can access any post!

// ‚úÖ DO: Use parameterized queries
await pool.execute(&#39;SELECT * FROM posts WHERE userId = ?&#39;, [userId]);

// ‚ùå DON&#39;T: Concatenate strings
await pool.execute(`SELECT * FROM posts WHERE userId = ${userId}`);
</code></pre>
<hr>
<h2 id="heading-9">Testing Flow</h2><pre><code class="language-bash"># 1. Login
curl -X POST http://localhost:3000/auth/login \
  -H &quot;Content-Type: application/json&quot; \
  -d &#39;{&quot;email&quot;:&quot;user@example.com&quot;,&quot;password&quot;:&quot;SecurePass123!&quot;}&#39;

# Response includes: &quot;accessToken&quot;: &quot;eyJhbG...&quot;

# 2. Use token in subsequent requests
TOKEN=&quot;eyJhbG...&quot;

curl http://localhost:3000/api/posts/mine \
  -H &quot;Authorization: Bearer $TOKEN&quot;
</code></pre>
<hr>
<h2 id="heading-10">Database Setup</h2><pre><code class="language-sql">-- Link data to users with foreign key
CREATE TABLE posts (
  id INT AUTO_INCREMENT PRIMARY KEY,
  userId INT NOT NULL,
  title VARCHAR(255),
  content TEXT,
  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  -- Link to users table
  FOREIGN KEY (userId) 
    REFERENCES secure_auth_users(id) 
    ON DELETE CASCADE,
    
  -- Speed up queries
  INDEX idx_user_posts (userId, createdAt)
);
</code></pre>
<hr>
<h2 id="heading-11">Common Mistakes ‚ùå</h2><h3 id="heading-12">Mistake 1: Not checking ownership</h3><pre><code class="language-javascript">// ‚ùå BAD
app.delete(&#39;/api/posts/:id&#39;, auth.middleware(), async (req, res) =&gt; {
  await pool.execute(&#39;DELETE FROM posts WHERE id = ?&#39;, [req.params.id]);
  // User can delete ANYONE&#39;s post!
});

// ‚úÖ GOOD
app.delete(&#39;/api/posts/:id&#39;, auth.middleware(), async (req, res) =&gt; {
  await pool.execute(
    &#39;DELETE FROM posts WHERE id = ? AND userId = ?&#39;,
    [req.params.id, req.user.userId]
  );
});
</code></pre>
<h3 id="heading-13">Mistake 2: Trusting client-provided IDs</h3><pre><code class="language-javascript">// ‚ùå BAD
app.post(&#39;/api/posts&#39;, auth.middleware(), async (req, res) =&gt; {
  const { userId, title } = req.body;
  // Client can fake userId!
  await pool.execute(&#39;INSERT INTO posts (userId, title) VALUES (?, ?)&#39;, 
    [userId, title]);
});

// ‚úÖ GOOD
app.post(&#39;/api/posts&#39;, auth.middleware(), async (req, res) =&gt; {
  const userId = req.user.userId;  // From authenticated token
  const { title } = req.body;
  await pool.execute(&#39;INSERT INTO posts (userId, title) VALUES (?, ?)&#39;, 
    [userId, title]);
});
</code></pre>
<h3 id="heading-14">Mistake 3: SQL injection</h3><pre><code class="language-javascript">// ‚ùå BAD
const userId = req.user.userId;
const [posts] = await pool.execute(
  `SELECT * FROM posts WHERE userId = ${userId}`
);

// ‚úÖ GOOD
const userId = req.user.userId;
const [posts] = await pool.execute(
  &#39;SELECT * FROM posts WHERE userId = ?&#39;,
  [userId]
);
</code></pre>
<hr>
<h2 id="heading-15">Frontend Integration</h2><pre><code class="language-javascript">// Save token after login
localStorage.setItem(&#39;accessToken&#39;, token);

// Use token in requests
const response = await fetch(&#39;/api/posts/mine&#39;, {
  headers: {
    &#39;Authorization&#39;: `Bearer ${localStorage.getItem(&#39;accessToken&#39;)}`
  }
});
</code></pre>
<hr>
<h2 id="heading-16">Quick Troubleshooting</h2><table>
<thead>
<tr>
<th>Error</th>
<th>Solution</th>
</tr>
</thead>
<tbody><tr>
<td>&quot;No token provided&quot;</td>
<td>Add <code>Authorization: Bearer TOKEN</code> header</td>
</tr>
<tr>
<td>&quot;Invalid token&quot;</td>
<td>Token expired or invalid, login again</td>
</tr>
<tr>
<td>&quot;Not found or unauthorized&quot;</td>
<td>User doesn&#39;t own the resource</td>
</tr>
<tr>
<td>SQL error</td>
<td>Check database exists and table created</td>
</tr>
</tbody></table>
<hr>
<h2 id="heading-17">üéì Remember</h2><ol>
<li><strong>Always</strong> use <code>req.user.userId</code> (from token)</li>
<li><strong>Never</strong> trust <code>req.body.userId</code> (from client)</li>
<li><strong>Always</strong> check ownership (WHERE ... AND userId = ?)</li>
<li><strong>Always</strong> use parameterized queries (?)</li>
<li><strong>Always</strong> validate inputs</li>
</ol>
<hr>
<h2 id="heading-18">Need More Help?</h2><ul>
<li>Full guide: <a href="USER_DATA_ACCESS.md">USER_DATA_ACCESS.md</a></li>
<li>Working example: <a href="../examples/user-posts-example.js">examples/user-posts-example.js</a></li>
<li>Flow diagram: <a href="FLOW_DIAGRAM.md">FLOW_DIAGRAM.md</a></li>
</ul>
<hr>
<p><strong>That&#39;s it! You now know how to securely access user-specific data! üéâ</strong></p>
</div>

        <!-- Navigation Buttons -->
        <div id="doc-navigation" class="mt-12 pt-8 border-t-2 border-gray-800"><div class="flex flex-col sm:flex-row justify-between gap-4">
      <a href="FLOW_DIAGRAM.html" class="nav-button-outline">
        <i class="fas fa-arrow-left"></i>
        <span>Flow Diagram</span>
      </a>
      <a href="USER_DATA_ACCESS.html" class="nav-button">
        <span>User Data Access</span>
        <i class="fas fa-arrow-right"></i>
      </a></div></div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="../js/static-docs.js"></script>
  </body>
</html>
