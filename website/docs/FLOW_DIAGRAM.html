<!doctype html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Authentication Flow Diagram - Secure Node Auth</title>
    <meta name="description" content="Visual guide showing how authentication flows work in Secure Node Auth from registration to token refresh." />

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Authentication Flow Diagram - Secure Node Auth" />
    <meta property="og:description" content="Visual guide showing how authentication flows work in Secure Node Auth from registration to token refresh." />
    <meta property="og:site_name" content="Secure Node Auth" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Authentication Flow Diagram - Secure Node Auth" />
    <meta name="twitter:description" content="Visual guide showing how authentication flows work in Secure Node Auth from registration to token refresh." />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#667eea',
              secondary: '#764ba2',
            },
          },
        },
      };
    </script>

    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Highlight.js for code syntax highlighting -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell,
          sans-serif;
      }

      /* Sidebar styles */
      .sidebar {
        position: fixed;
        top: 64px;
        left: 0;
        bottom: 0;
        width: 280px;
        overflow-y: auto;
        background: #1a202c;
        border-right: 1px solid #2d3748;
        transition: transform 0.3s ease;
      }

      .sidebar::-webkit-scrollbar {
        width: 6px;
      }

      .sidebar::-webkit-scrollbar-track {
        background: #1a202c;
      }

      .sidebar::-webkit-scrollbar-thumb {
        background: #4a5568;
        border-radius: 3px;
      }

      .sidebar-hidden {
        transform: translateX(-100%);
      }

      .content-wrapper {
        margin-left: 280px;
        transition: margin-left 0.3s ease;
      }

      .content-wrapper.expanded {
        margin-left: 0;
      }

      /* TOC styles */
      .toc-item {
        padding: 0.5rem 1rem;
        cursor: pointer;
        transition: all 0.2s;
        border-left: 3px solid transparent;
      }

      .toc-item:hover {
        background: #2d3748;
        border-left-color: #667eea;
      }

      .toc-item.active {
        background: #2d3748;
        border-left-color: #667eea;
        color: #667eea;
      }

      .toc-h2 {
        font-size: 0.875rem;
        font-weight: 600;
      }

      .toc-h3 {
        font-size: 0.8rem;
        padding-left: 1.5rem;
        color: #a0aec0;
      }

      /* Markdown styles */
      .markdown-body {
        color: #e1e4e8;
        line-height: 1.8;
      }

      .markdown-body h1 {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid #667eea;
        scroll-margin-top: 80px;
      }

      .markdown-body h2 {
        font-size: 2rem;
        font-weight: bold;
        margin-top: 3rem;
        margin-bottom: 1rem;
        color: #667eea;
        scroll-margin-top: 80px;
      }

      .markdown-body h3 {
        font-size: 1.5rem;
        font-weight: bold;
        margin-top: 2rem;
        margin-bottom: 0.75rem;
        color: #8b9cdb;
        scroll-margin-top: 80px;
      }

      .markdown-body h4 {
        font-size: 1.25rem;
        font-weight: bold;
        margin-top: 1.5rem;
        margin-bottom: 0.5rem;
        color: #a0aec0;
      }

      .markdown-body p {
        margin-bottom: 1rem;
      }

      .markdown-body ul,
      .markdown-body ol {
        margin-bottom: 1rem;
        padding-left: 2rem;
      }

      .markdown-body li {
        margin-bottom: 0.5rem;
      }

      .markdown-body code {
        background: #1a1a2e;
        padding: 0.2rem 0.5rem;
        border-radius: 0.25rem;
        font-size: 0.9em;
        font-family: 'Consolas', 'Monaco', monospace;
      }

      .markdown-body pre {
        background: #1a1a2e;
        padding: 1.5rem;
        border-radius: 0.5rem;
        overflow-x: auto;
        margin: 1.5rem 0;
        border: 1px solid #2d3748;
      }

      .markdown-body pre code {
        background: transparent;
        padding: 0;
      }

      .markdown-body a {
        color: #667eea;
        text-decoration: none;
        transition: color 0.2s;
      }

      .markdown-body a:hover {
        color: #8b9cdb;
        text-decoration: underline;
      }

      .markdown-body blockquote {
        border-left: 4px solid #667eea;
        padding-left: 1rem;
        margin: 1.5rem 0;
        color: #a0aec0;
        background: #1a202c;
        padding: 1rem;
        border-radius: 0.25rem;
      }

      .markdown-body table {
        width: 100%;
        margin: 1.5rem 0;
        border-collapse: collapse;
      }

      .markdown-body th,
      .markdown-body td {
        border: 1px solid #4a5568;
        padding: 0.75rem;
        text-align: left;
      }

      .markdown-body th {
        background: #2d3748;
        font-weight: bold;
        color: #667eea;
      }

      .markdown-body tr:hover {
        background: #1a202c;
      }

      .markdown-body img {
        max-width: 100%;
        height: auto;
        border-radius: 0.5rem;
        margin: 1.5rem 0;
      }

      .markdown-body hr {
        border: none;
        border-top: 2px solid #2d3748;
        margin: 2rem 0;
      }

      /* Navigation buttons */
      .nav-button {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 0.5rem;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s;
      }

      .nav-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      .nav-button-outline {
        background: transparent;
        border: 2px solid #667eea;
        color: #667eea;
      }

      .nav-button-outline:hover {
        background: #667eea;
        color: white;
      }

      /* Mobile styles */
      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.mobile-open {
          transform: translateX(0);
          z-index: 40;
        }

        .content-wrapper {
          margin-left: 0;
        }
      }
    </style>
  </head>
  <body class="bg-gray-900 text-white">
    <!-- Top Navigation -->
    <nav
      class="fixed w-full top-0 z-50 bg-gray-900 border-b border-gray-800 backdrop-blur-lg bg-opacity-95"
    >
      <div class="px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <div class="flex items-center gap-4">
            <button
              id="sidebar-toggle"
              class="text-2xl text-gray-300 hover:text-primary transition"
            >
              <i class="fas fa-bars"></i>
            </button>
            <a href="/" class="flex items-center space-x-2">
              <i class="fas fa-shield-alt text-primary text-2xl"></i>
              <span class="text-xl font-bold">SecureNodeAuth</span>
            </a>
          </div>
          <div class="flex items-center gap-4">
            <a
              href="/"
              class="flex items-center gap-2 text-gray-300 hover:text-primary transition"
            >
              <i class="fas fa-home"></i>
              <span>Home</span>
            </a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Sidebar with TOC -->
    <aside id="sidebar" class="sidebar">
      <div class="p-4">
        <h3 class="text-sm font-bold text-gray-400 uppercase mb-2">Table of Contents</h3>
        <div id="toc" class="space-y-1">
    <div class="toc-item toc-h1" data-target="heading-0">
      ğŸ”„ Authentication Flow Diagram
    </div>
    <div class="toc-item toc-h2" data-target="heading-1">
      How User Data Access Works
    </div>
    <div class="toc-item toc-h2" data-target="heading-2">
      ğŸ”‘ The Magic: `req.user.userId`
    </div>
    <div class="toc-item toc-h2" data-target="heading-3">
      ğŸ“Š Database Relationships
    </div>
    <div class="toc-item toc-h2" data-target="heading-4">
      ğŸ¯ Key Security Principles
    </div>
    <div class="toc-item toc-h2" data-target="heading-5">
      ğŸ”„ Complete Flow Summary
    </div>
    <div class="toc-item toc-h2" data-target="heading-6">
      ğŸ’¡ Simple Example
    </div></div>
      </div>
    </aside>

    <!-- Main Content -->
    <div id="content-wrapper" class="content-wrapper pt-20 pb-12 px-4 sm:px-6 lg:px-8">
      <div class="max-w-4xl mx-auto">
        <!-- Markdown Content (Server-rendered for SEO) -->
        <div id="content" class="markdown-body"><h1 id="heading-0">ğŸ”„ Authentication Flow Diagram</h1><h2 id="heading-1">How User Data Access Works</h2><pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER AUTHENTICATION FLOW                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: USER REGISTERS/LOGINS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚â”€â”€â”€â”€â”€â”€â”
â”‚  (Browser)  â”‚      â”‚ POST /auth/register
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ { email, password }
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚    Server    â”‚
              â”‚ (Auth System)â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ Creates user record
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Database   â”‚
              â”‚ secure_auth_ â”‚â”€â”€â”€â”€ Stores: id=123, email, password_hash
              â”‚    users     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ Returns JWT tokens
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   Client    â”‚â—„â”€â”€â”€â”€â”€â”˜
â”‚  Receives:  â”‚
â”‚  accessToken: &quot;eyJhbG...&quot;
â”‚  refreshToken: &quot;eyJhbG...&quot;
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Step 2: CLIENT MAKES AUTHENTICATED REQUEST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚      â”‚ GET /api/posts/my-posts
â”‚ Sends:      â”‚      â”‚ Authorization: Bearer eyJhbG...
â”‚ accessToken â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ auth.middleware()     â”‚
              â”‚                       â”‚
              â”‚ 1. Extract token      â”‚
              â”‚ 2. Verify signature   â”‚
              â”‚ 3. Check expiration   â”‚
              â”‚ 4. Decode payload     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ Token is valid!
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Route Handler        â”‚
              â”‚                       â”‚
              â”‚  req.user = {         â”‚
              â”‚    userId: 123,       â”‚â”€â”€â”€â”€ ğŸ‘ˆ This is the key!
              â”‚    email: &quot;user@...&quot;  â”‚
              â”‚  }                    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ Query with userId
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Database Query      â”‚
              â”‚                       â”‚
              â”‚ SELECT * FROM posts   â”‚
              â”‚ WHERE userId = 123    â”‚â”€â”€â”€â”€ Only user&#39;s data!
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ Returns user&#39;s posts
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   Client    â”‚â—„â”€â”€â”€â”€â”€â”˜
â”‚  Receives:  â”‚
â”‚  { posts: [...] }
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Step 3: CLIENT CREATES NEW POST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚      â”‚ POST /api/posts
â”‚ Sends:      â”‚      â”‚ Authorization: Bearer eyJhbG...
â”‚ {title,     â”‚      â”‚ { title: &quot;My Post&quot;, content: &quot;...&quot; }
â”‚  content}   â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ auth.middleware()     â”‚
              â”‚ Decodes to:           â”‚
              â”‚ req.user.userId = 123 â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Route Handler        â”‚
              â”‚                       â”‚
              â”‚ const userId =        â”‚
              â”‚   req.user.userId;    â”‚â”€â”€â”€â”€ Gets authenticated user&#39;s ID
              â”‚                       â”‚
              â”‚ INSERT INTO posts     â”‚
              â”‚ (userId, title, ...)  â”‚
              â”‚ VALUES (123, ...)     â”‚â”€â”€â”€â”€ Automatically ties to user!
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Database   â”‚
              â”‚    posts     â”‚â”€â”€â”€â”€ Stores: id=1, userId=123, title, content
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   Client    â”‚â—„â”€â”€â”€â”€â”€â”˜
â”‚  Success!   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Step 4: USER UPDATES THEIR POST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚      â”‚ PATCH /api/posts/5
â”‚ Sends:      â”‚      â”‚ Authorization: Bearer eyJhbG...
â”‚ {title:     â”‚      â”‚ { title: &quot;Updated&quot; }
â”‚  &quot;Updated&quot;} â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ auth.middleware()     â”‚
              â”‚ req.user.userId = 123 â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Route Handler                â”‚
              â”‚                               â”‚
              â”‚  // SECURITY CHECK!           â”‚
              â”‚  SELECT * FROM posts          â”‚
              â”‚  WHERE id = 5                 â”‚â”€â”€â”€â”€ Verify ownership
              â”‚  AND userId = 123             â”‚
              â”‚                               â”‚
              â”‚  if (found) {                 â”‚
              â”‚    UPDATE posts               â”‚
              â”‚    WHERE id = 5               â”‚
              â”‚    AND userId = 123           â”‚
              â”‚  } else {                     â”‚
              â”‚    return 403 Forbidden       â”‚â”€â”€â”€â”€ Can&#39;t edit others&#39; posts!
              â”‚  }                            â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr>
<h2 id="heading-2">ğŸ”‘ The Magic: `req.user.userId`</h2><p>Every authenticated request automatically has access to:</p>
<pre><code class="language-javascript">req.user = {
  userId: 123,              // â† Use this to filter user&#39;s data
  email: &quot;user@example.com&quot;,
  iat: 1699268400,          // Token issued at
  exp: 1699269300           // Token expires at
}
</code></pre>
<hr>
<h2 id="heading-3">ğŸ“Š Database Relationships</h2><pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   secure_auth_users          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)        â”‚ 123        â”‚ â†â”€â”€â”€â”€â”
â”‚ email          â”‚ user@...   â”‚      â”‚
â”‚ password       â”‚ $2b$10...  â”‚      â”‚
â”‚ firstName      â”‚ John       â”‚      â”‚
â”‚ createdAt      â”‚ 2025-11-06 â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                                     â”‚
                                     â”‚ FOREIGN KEY
                                     â”‚ (userId)
                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   posts                      â”‚      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚ id (PK)        â”‚ 1          â”‚      â”‚
â”‚ userId (FK)    â”‚ 123        â”‚ â”€â”€â”€â”€â”€â”˜
â”‚ title          â”‚ My Post    â”‚
â”‚ content        â”‚ Hello!     â”‚
â”‚ createdAt      â”‚ 2025-11-06 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â†‘
    â”‚ SELECT * FROM posts WHERE userId = 123
    â”‚
    This query ONLY returns posts
    belonging to user with id=123
</code></pre>
<hr>
<h2 id="heading-4">ğŸ¯ Key Security Principles</h2><pre><code class="language-javascript">// âœ… ALWAYS filter by authenticated user
const userId = req.user.userId;  // From JWT token
const [posts] = await pool.execute(
  &#39;SELECT * FROM posts WHERE userId = ?&#39;,
  [userId]  // Only returns THIS user&#39;s posts
);

// âœ… ALWAYS verify ownership before update/delete
const [result] = await pool.execute(
  &#39;DELETE FROM posts WHERE id = ? AND userId = ?&#39;,
  [postId, userId]  // AND ensures user owns the post
);

// âŒ NEVER trust client-provided user IDs
// Bad: const userId = req.body.userId; 
// Good: const userId = req.user.userId;
</code></pre>
<hr>
<h2 id="heading-5">ğŸ”„ Complete Flow Summary</h2><pre><code>1. User logs in
   â†“
2. Server creates JWT with userId
   â†“
3. Client stores token
   â†“
4. Client sends token with every request
   â†“
5. Middleware extracts userId from token
   â†“
6. Route handler uses userId to query database
   â†“
7. Database returns only that user&#39;s data
</code></pre>
<hr>
<h2 id="heading-6">ğŸ’¡ Simple Example</h2><pre><code class="language-javascript">// User A (userId: 123) logs in
// Gets token: eyJhbG...userId:123...

// User A requests their posts:
app.get(&#39;/api/posts/my-posts&#39;, auth.middleware(), async (req, res) =&gt; {
  // req.user.userId = 123 (from token)
  
  const [posts] = await pool.execute(
    &#39;SELECT * FROM posts WHERE userId = ?&#39;,
    [req.user.userId]  // = 123
  );
  
  // Returns only posts where userId = 123
  res.json({ posts });
});

// User A CANNOT see User B&#39;s posts because:
// - Token contains userId = 123
// - Query filters by userId = 123
// - User B&#39;s posts have userId = 456
// - 123 â‰  456, so User B&#39;s posts are excluded
</code></pre>
<p>This is how secure-node-auth protects user data! ğŸ”’</p>
</div>

        <!-- Navigation Buttons -->
        <div id="doc-navigation" class="mt-12 pt-8 border-t-2 border-gray-800"><div class="flex flex-col sm:flex-row justify-between gap-4">
      <a href="API_REFERENCE.html" class="nav-button-outline">
        <i class="fas fa-arrow-left"></i>
        <span>API Reference</span>
      </a>
      <a href="QUICK_REFERENCE_USER_DATA.html" class="nav-button">
        <span>User Data Reference</span>
        <i class="fas fa-arrow-right"></i>
      </a></div></div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="../js/static-docs.js"></script>
  </body>
</html>
