<!doctype html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Headless Apps Authentication Part 3 - Secure Node Auth</title>
    <meta name="description" content="Complete headless authentication with mobile apps, SSR, and advanced patterns. Part 3 of 3." />

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Headless Apps Authentication Part 3 - Secure Node Auth" />
    <meta property="og:description" content="Complete headless authentication with mobile apps, SSR, and advanced patterns. Part 3 of 3." />
    <meta property="og:site_name" content="Secure Node Auth" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Headless Apps Authentication Part 3 - Secure Node Auth" />
    <meta name="twitter:description" content="Complete headless authentication with mobile apps, SSR, and advanced patterns. Part 3 of 3." />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#667eea',
              secondary: '#764ba2',
            },
          },
        },
      };
    </script>

    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Highlight.js for code syntax highlighting -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell,
          sans-serif;
      }

      /* Sidebar styles */
      .sidebar {
        position: fixed;
        top: 64px;
        left: 0;
        bottom: 0;
        width: 280px;
        overflow-y: auto;
        background: #1a202c;
        border-right: 1px solid #2d3748;
        transition: transform 0.3s ease;
      }

      .sidebar::-webkit-scrollbar {
        width: 6px;
      }

      .sidebar::-webkit-scrollbar-track {
        background: #1a202c;
      }

      .sidebar::-webkit-scrollbar-thumb {
        background: #4a5568;
        border-radius: 3px;
      }

      .sidebar-hidden {
        transform: translateX(-100%);
      }

      .content-wrapper {
        margin-left: 280px;
        transition: margin-left 0.3s ease;
      }

      .content-wrapper.expanded {
        margin-left: 0;
      }

      /* TOC styles */
      .toc-item {
        padding: 0.5rem 1rem;
        cursor: pointer;
        transition: all 0.2s;
        border-left: 3px solid transparent;
      }

      .toc-item:hover {
        background: #2d3748;
        border-left-color: #667eea;
      }

      .toc-item.active {
        background: #2d3748;
        border-left-color: #667eea;
        color: #667eea;
      }

      .toc-h2 {
        font-size: 0.875rem;
        font-weight: 600;
      }

      .toc-h3 {
        font-size: 0.8rem;
        padding-left: 1.5rem;
        color: #a0aec0;
      }

      /* Markdown styles */
      .markdown-body {
        color: #e1e4e8;
        line-height: 1.8;
      }

      .markdown-body h1 {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid #667eea;
        scroll-margin-top: 80px;
      }

      .markdown-body h2 {
        font-size: 2rem;
        font-weight: bold;
        margin-top: 3rem;
        margin-bottom: 1rem;
        color: #667eea;
        scroll-margin-top: 80px;
      }

      .markdown-body h3 {
        font-size: 1.5rem;
        font-weight: bold;
        margin-top: 2rem;
        margin-bottom: 0.75rem;
        color: #8b9cdb;
        scroll-margin-top: 80px;
      }

      .markdown-body h4 {
        font-size: 1.25rem;
        font-weight: bold;
        margin-top: 1.5rem;
        margin-bottom: 0.5rem;
        color: #a0aec0;
      }

      .markdown-body p {
        margin-bottom: 1rem;
      }

      .markdown-body ul,
      .markdown-body ol {
        margin-bottom: 1rem;
        padding-left: 2rem;
      }

      .markdown-body li {
        margin-bottom: 0.5rem;
      }

      .markdown-body code {
        background: #1a1a2e;
        padding: 0.2rem 0.5rem;
        border-radius: 0.25rem;
        font-size: 0.9em;
        font-family: 'Consolas', 'Monaco', monospace;
      }

      .markdown-body pre {
        background: #1a1a2e;
        padding: 1.5rem;
        border-radius: 0.5rem;
        overflow-x: auto;
        margin: 1.5rem 0;
        border: 1px solid #2d3748;
      }

      .markdown-body pre code {
        background: transparent;
        padding: 0;
      }

      .markdown-body a {
        color: #667eea;
        text-decoration: none;
        transition: color 0.2s;
      }

      .markdown-body a:hover {
        color: #8b9cdb;
        text-decoration: underline;
      }

      .markdown-body blockquote {
        border-left: 4px solid #667eea;
        padding-left: 1rem;
        margin: 1.5rem 0;
        color: #a0aec0;
        background: #1a202c;
        padding: 1rem;
        border-radius: 0.25rem;
      }

      .markdown-body table {
        width: 100%;
        margin: 1.5rem 0;
        border-collapse: collapse;
      }

      .markdown-body th,
      .markdown-body td {
        border: 1px solid #4a5568;
        padding: 0.75rem;
        text-align: left;
      }

      .markdown-body th {
        background: #2d3748;
        font-weight: bold;
        color: #667eea;
      }

      .markdown-body tr:hover {
        background: #1a202c;
      }

      .markdown-body img {
        max-width: 100%;
        height: auto;
        border-radius: 0.5rem;
        margin: 1.5rem 0;
      }

      .markdown-body hr {
        border: none;
        border-top: 2px solid #2d3748;
        margin: 2rem 0;
      }

      /* Navigation buttons */
      .nav-button {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 0.5rem;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s;
      }

      .nav-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      .nav-button-outline {
        background: transparent;
        border: 2px solid #667eea;
        color: #667eea;
      }

      .nav-button-outline:hover {
        background: #667eea;
        color: white;
      }

      /* Mobile styles */
      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.mobile-open {
          transform: translateX(0);
          z-index: 40;
        }

        .content-wrapper {
          margin-left: 0;
        }
      }
    </style>
  </head>
  <body class="bg-gray-900 text-white">
    <!-- Top Navigation -->
    <nav
      class="fixed w-full top-0 z-50 bg-gray-900 border-b border-gray-800 backdrop-blur-lg bg-opacity-95"
    >
      <div class="px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <div class="flex items-center gap-4">
            <button
              id="sidebar-toggle"
              class="text-2xl text-gray-300 hover:text-primary transition"
            >
              <i class="fas fa-bars"></i>
            </button>
            <a href="/" class="flex items-center space-x-2">
              <i class="fas fa-shield-alt text-primary text-2xl"></i>
              <span class="text-xl font-bold">SecureNodeAuth</span>
            </a>
          </div>
          <div class="flex items-center gap-4">
            <a
              href="/"
              class="flex items-center gap-2 text-gray-300 hover:text-primary transition"
            >
              <i class="fas fa-home"></i>
              <span>Home</span>
            </a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Sidebar with TOC -->
    <aside id="sidebar" class="sidebar">
      <div class="p-4">
        <h3 class="text-sm font-bold text-gray-400 uppercase mb-2">Table of Contents</h3>
        <div id="toc" class="space-y-1">
    <div class="toc-item toc-h1" data-target="heading-0">
      Headless Apps Guide - Part 3
    </div>
    <div class="toc-item toc-h2" data-target="heading-1">
      Advanced Patterns, Mobile App, and Best Practices
    </div>
    <div class="toc-item toc-h2" data-target="heading-2">
      Advanced Patterns
    </div>
    <div class="toc-item toc-h3" data-target="heading-3">
      10. Database Transactions for Complex Operations
    </div>
    <div class="toc-item toc-h3" data-target="heading-5">
      11. Recurring Transactions (Background Job)
    </div>
    <div class="toc-item toc-h3" data-target="heading-6">
      12. Budget Alerts (Real-time Monitoring)
    </div>
    <div class="toc-item toc-h2" data-target="heading-7">
      Mobile App Integration (React Native)
    </div>
    <div class="toc-item toc-h3" data-target="heading-8">
      13. React Native Setup
    </div>
    <div class="toc-item toc-h3" data-target="heading-9">
      14. API Service (src/services/api.js)
    </div>
    <div class="toc-item toc-h3" data-target="heading-10">
      15. Auth Context for Mobile (src/context/AuthContext.js)
    </div>
    <div class="toc-item toc-h2" data-target="heading-11">
      Best Practices
    </div>
    <div class="toc-item toc-h3" data-target="heading-12">
      16. Security Best Practices
    </div>
    <div class="toc-item toc-h3" data-target="heading-16">
      17. Error Handling Middleware
    </div>
    <div class="toc-item toc-h3" data-target="heading-17">
      18. Input Validation Utility
    </div>
    <div class="toc-item toc-h3" data-target="heading-18">
      19. Database Backup Script
    </div>
    <div class="toc-item toc-h3" data-target="heading-19">
      20. Performance Monitoring
    </div>
    <div class="toc-item toc-h2" data-target="heading-20">
      Deployment Checklist
    </div>
    <div class="toc-item toc-h3" data-target="heading-21">
      Production Environment
    </div>
    <div class="toc-item toc-h2" data-target="heading-22">
      Summary
    </div></div>
      </div>
    </aside>

    <!-- Main Content -->
    <div id="content-wrapper" class="content-wrapper pt-20 pb-12 px-4 sm:px-6 lg:px-8">
      <div class="max-w-4xl mx-auto">
        <!-- Markdown Content (Server-rendered for SEO) -->
        <div id="content" class="markdown-body"><h1 id="heading-0">Headless Apps Guide - Part 3</h1><h2 id="heading-1">Advanced Patterns, Mobile App, and Best Practices</h2><hr>
<h2 id="heading-2">Advanced Patterns</h2><h3 id="heading-3">10. Database Transactions for Complex Operations</h3><p>When operations involve multiple tables, use transactions to ensure data consistency.</p>
<h4 id="heading-4">Example: Transfer Between Accounts</h4><pre><code class="language-javascript">// src/routes/transfers.js
const express = require(&#39;express&#39;);
const router = express.Router();

router.post(&#39;/transfer&#39;, async (req, res) =&gt; {
  try {
    const userId = req.user.userId;
    const { fromAccountId, toAccountId, amount, description } = req.body;
    const pool = req.app.get(&#39;dbPool&#39;);
    
    if (!fromAccountId || !toAccountId || !amount) {
      return res.status(400).json({
        success: false,
        error: &#39;Missing required fields&#39;
      });
    }
    
    if (amount &lt;= 0) {
      return res.status(400).json({
        success: false,
        error: &#39;Amount must be positive&#39;
      });
    }
    
    const connection = await pool.getConnection();
    
    try {
      await connection.beginTransaction();
      
      // Verify both accounts belong to user
      const [fromAccount] = await connection.execute(
        &#39;SELECT id, balance FROM accounts WHERE id = ? AND userId = ? FOR UPDATE&#39;,
        [fromAccountId, userId]
      );
      
      const [toAccount] = await connection.execute(
        &#39;SELECT id, balance FROM accounts WHERE id = ? AND userId = ? FOR UPDATE&#39;,
        [toAccountId, userId]
      );
      
      if (fromAccount.length === 0 || toAccount.length === 0) {
        await connection.rollback();
        return res.status(404).json({
          success: false,
          error: &#39;One or both accounts not found&#39;
        });
      }
      
      // Check sufficient balance
      if (parseFloat(fromAccount[0].balance) &lt; parseFloat(amount)) {
        await connection.rollback();
        return res.status(400).json({
          success: false,
          error: &#39;Insufficient balance&#39;
        });
      }
      
      // Create transfer category if not exists
      const [transferCategory] = await connection.execute(
        `INSERT IGNORE INTO categories (userId, name, type) VALUES (?, &#39;Transfer&#39;, &#39;expense&#39;)`,
        [userId]
      );
      
      const [categoryResult] = await connection.execute(
        `SELECT id FROM categories WHERE userId = ? AND name = &#39;Transfer&#39; LIMIT 1`,
        [userId]
      );
      
      const categoryId = categoryResult[0].id;
      
      // Deduct from source account
      await connection.execute(
        &#39;UPDATE accounts SET balance = balance - ? WHERE id = ?&#39;,
        [amount, fromAccountId]
      );
      
      // Add to destination account
      await connection.execute(
        &#39;UPDATE accounts SET balance = balance + ? WHERE id = ?&#39;,
        [amount, toAccountId]
      );
      
      // Create outgoing transaction
      const [outgoingResult] = await connection.execute(`
        INSERT INTO transactions 
        (userId, accountId, categoryId, amount, type, description, transactionDate)
        VALUES (?, ?, ?, ?, &#39;transfer&#39;, ?, CURDATE())
      `, [userId, fromAccountId, categoryId, amount, description || `Transfer to account ${toAccountId}`]);
      
      // Create incoming transaction
      await connection.execute(`
        INSERT INTO transactions 
        (userId, accountId, categoryId, amount, type, description, transactionDate)
        VALUES (?, ?, ?, ?, &#39;transfer&#39;, ?, CURDATE())
      `, [userId, toAccountId, categoryId, amount, description || `Transfer from account ${fromAccountId}`]);
      
      await connection.commit();
      
      res.json({
        success: true,
        message: &#39;Transfer completed successfully&#39;,
        data: {
          transactionId: outgoingResult.insertId,
          fromAccountId,
          toAccountId,
          amount: parseFloat(amount)
        }
      });
      
    } catch (error) {
      await connection.rollback();
      throw error;
    } finally {
      connection.release();
    }
    
  } catch (error) {
    console.error(&#39;Transfer error:&#39;, error);
    res.status(500).json({
      success: false,
      error: &#39;Transfer failed&#39;
    });
  }
});

module.exports = router;
</code></pre>
<h3 id="heading-5">11. Recurring Transactions (Background Job)</h3><p>Create a scheduled job to process recurring transactions.</p>
<pre><code class="language-javascript">// src/jobs/recurringTransactions.js
const cron = require(&#39;node-cron&#39;);

function startRecurringTransactionJob(pool) {
  // Run daily at midnight
  cron.schedule(&#39;0 0 * * *&#39;, async () =&gt; {
    console.log(&#39;Processing recurring transactions...&#39;);
    
    const connection = await pool.getConnection();
    
    try {
      await connection.beginTransaction();
      
      // Find due recurring transactions
      const [recurring] = await connection.execute(`
        SELECT * FROM recurring_transactions
        WHERE isActive = TRUE AND nextDueDate &lt;= CURDATE()
      `);
      
      console.log(`Found ${recurring.length} due recurring transactions`);
      
      for (const recur of recurring) {
        try {
          // Create transaction
          await connection.execute(`
            INSERT INTO transactions 
            (userId, accountId, categoryId, amount, type, description, transactionDate, isRecurring, recurringId)
            VALUES (?, ?, ?, ?, ?, ?, CURDATE(), TRUE, ?)
          `, [recur.userId, recur.accountId, recur.categoryId, recur.amount, 
              recur.type, recur.description, recur.id]);
          
          // Update account balance
          const balanceChange = recur.type === &#39;income&#39; ? recur.amount : -recur.amount;
          await connection.execute(
            &#39;UPDATE accounts SET balance = balance + ? WHERE id = ?&#39;,
            [balanceChange, recur.accountId]
          );
          
          // Calculate next due date
          let nextDue = new Date(recur.nextDueDate);
          
          switch (recur.frequency) {
            case &#39;daily&#39;:
              nextDue.setDate(nextDue.getDate() + 1);
              break;
            case &#39;weekly&#39;:
              nextDue.setDate(nextDue.getDate() + 7);
              break;
            case &#39;biweekly&#39;:
              nextDue.setDate(nextDue.getDate() + 14);
              break;
            case &#39;monthly&#39;:
              nextDue.setMonth(nextDue.getMonth() + 1);
              break;
            case &#39;yearly&#39;:
              nextDue.setFullYear(nextDue.getFullYear() + 1);
              break;
          }
          
          // Check if end date reached
          if (recur.endDate &amp;&amp; nextDue &gt; new Date(recur.endDate)) {
            await connection.execute(
              &#39;UPDATE recurring_transactions SET isActive = FALSE WHERE id = ?&#39;,
              [recur.id]
            );
          } else {
            await connection.execute(
              &#39;UPDATE recurring_transactions SET nextDueDate = ? WHERE id = ?&#39;,
              [nextDue.toISOString().split(&#39;T&#39;)[0], recur.id]
            );
          }
          
          console.log(`Processed recurring transaction ${recur.id}`);
          
        } catch (error) {
          console.error(`Failed to process recurring transaction ${recur.id}:`, error);
        }
      }
      
      await connection.commit();
      console.log(&#39;Recurring transactions processed successfully&#39;);
      
    } catch (error) {
      await connection.rollback();
      console.error(&#39;Recurring transaction job failed:&#39;, error);
    } finally {
      connection.release();
    }
  });
  
  console.log(&#39;Recurring transaction job scheduled (runs daily at midnight)&#39;);
}

module.exports = startRecurringTransactionJob;
</code></pre>
<p>Add to main server file:</p>
<pre><code class="language-javascript">// src/index.js
const startRecurringTransactionJob = require(&#39;./jobs/recurringTransactions&#39;);

// After initializing auth
startRecurringTransactionJob(appPool);
</code></pre>
<h3 id="heading-6">12. Budget Alerts (Real-time Monitoring)</h3><pre><code class="language-javascript">// src/utils/budgetAlerts.js
async function checkBudgetAlerts(userId, categoryId, pool) {
  try {
    // Get active budget for category
    const [budgets] = await pool.execute(`
      SELECT 
        b.*,
        c.name as categoryName,
        COALESCE(SUM(t.amount), 0) as spent
      FROM budgets b
      JOIN categories c ON b.categoryId = c.id
      LEFT JOIN transactions t ON t.categoryId = b.categoryId 
        AND t.userId = b.userId 
        AND t.type = &#39;expense&#39;
        AND t.transactionDate &gt;= b.startDate
        AND (b.endDate IS NULL OR t.transactionDate &lt;= b.endDate)
      WHERE b.userId = ? AND b.categoryId = ?
      GROUP BY b.id
    `, [userId, categoryId]);
    
    if (budgets.length === 0) return null;
    
    const budget = budgets[0];
    const percentage = (parseFloat(budget.spent) / parseFloat(budget.amount)) * 100;
    
    // Check if alert threshold reached
    if (percentage &gt;= budget.alertThreshold &amp;&amp; percentage &lt; 100) {
      return {
        type: &#39;warning&#39;,
        message: `You&#39;ve spent ${percentage.toFixed(1)}% of your ${budget.categoryName} budget`,
        budget: {
          category: budget.categoryName,
          spent: parseFloat(budget.spent),
          amount: parseFloat(budget.amount),
          percentage: percentage.toFixed(1),
          remaining: parseFloat(budget.amount) - parseFloat(budget.spent)
        }
      };
    }
    
    // Check if budget exceeded
    if (percentage &gt;= 100) {
      return {
        type: &#39;exceeded&#39;,
        message: `You&#39;ve exceeded your ${budget.categoryName} budget by ${((percentage - 100)).toFixed(1)}%`,
        budget: {
          category: budget.categoryName,
          spent: parseFloat(budget.spent),
          amount: parseFloat(budget.amount),
          percentage: percentage.toFixed(1),
          over: parseFloat(budget.spent) - parseFloat(budget.amount)
        }
      };
    }
    
    return null;
  } catch (error) {
    console.error(&#39;Budget alert check failed:&#39;, error);
    return null;
  }
}

module.exports = { checkBudgetAlerts };
</code></pre>
<p>Use in transaction creation:</p>
<pre><code class="language-javascript">// In transaction POST route, after creating transaction
const { checkBudgetAlerts } = require(&#39;../utils/budgetAlerts&#39;);

// ... after transaction created ...

// Check budget alerts
const alert = await checkBudgetAlerts(userId, categoryId, pool);
if (alert) {
  res.status(201).json({
    success: true,
    message: &#39;Transaction created successfully&#39;,
    data: newTransaction[0],
    budgetAlert: alert // Include alert in response
  });
} else {
  res.status(201).json({
    success: true,
    message: &#39;Transaction created successfully&#39;,
    data: newTransaction[0]
  });
}
</code></pre>
<hr>
<h2 id="heading-7">Mobile App Integration (React Native)</h2><h3 id="heading-8">13. React Native Setup</h3><pre><code class="language-bash">npx react-native init ExpenseTrackerMobile
cd ExpenseTrackerMobile
npm install axios @react-navigation/native @react-navigation/stack
npm install react-native-screens react-native-safe-area-context
</code></pre>
<h3 id="heading-9">14. API Service (src/services/api.js)</h3><pre><code class="language-javascript">import axios from &#39;axios&#39;;
import AsyncStorage from &#39;@react-native-async-storage/async-storage&#39;;

const API_BASE_URL = &#39;http://your-api-url.com/api&#39;;

const api = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    &#39;Content-Type&#39;: &#39;application/json&#39;,
  },
});

// Request interceptor
api.interceptors.request.use(
  async (config) =&gt; {
    const token = await AsyncStorage.getItem(&#39;accessToken&#39;);
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) =&gt; Promise.reject(error)
);

// Response interceptor for token refresh
api.interceptors.response.use(
  (response) =&gt; response,
  async (error) =&gt; {
    const originalRequest = error.config;

    if (error.response?.status === 401 &amp;&amp; !originalRequest._retry) {
      originalRequest._retry = true;

      try {
        const refreshToken = await AsyncStorage.getItem(&#39;refreshToken&#39;);
        const response = await axios.post(`${API_BASE_URL}/auth/refresh`, {
          refreshToken,
        });

        const { accessToken } = response.data.data;
        await AsyncStorage.setItem(&#39;accessToken&#39;, accessToken);

        originalRequest.headers.Authorization = `Bearer ${accessToken}`;
        return api(originalRequest);
      } catch (refreshError) {
        await AsyncStorage.multiRemove([&#39;accessToken&#39;, &#39;refreshToken&#39;, &#39;user&#39;]);
        // Navigate to login screen
        return Promise.reject(refreshError);
      }
    }

    return Promise.reject(error);
  }
);

// Auth API
export const authAPI = {
  login: async (email, password) =&gt; {
    const response = await api.post(&#39;/auth/login&#39;, { email, password });
    const { user, tokens } = response.data.data;
    
    await AsyncStorage.multiSet([
      [&#39;accessToken&#39;, tokens.accessToken],
      [&#39;refreshToken&#39;, tokens.refreshToken],
      [&#39;user&#39;, JSON.stringify(user)]
    ]);
    
    return response.data;
  },
  
  logout: async () =&gt; {
    const refreshToken = await AsyncStorage.getItem(&#39;refreshToken&#39;);
    await api.post(&#39;/auth/logout&#39;, { refreshToken });
    await AsyncStorage.multiRemove([&#39;accessToken&#39;, &#39;refreshToken&#39;, &#39;user&#39;]);
  }
};

// Transaction API (same as web)
export const transactionAPI = {
  getAll: async (params = {}) =&gt; {
    const response = await api.get(&#39;/transactions&#39;, { params });
    return response.data;
  },
  // ... other methods
};

export default api;
</code></pre>
<h3 id="heading-10">15. Auth Context for Mobile (src/context/AuthContext.js)</h3><pre><code class="language-javascript">import React, { createContext, useState, useContext, useEffect } from &#39;react&#39;;
import AsyncStorage from &#39;@react-native-async-storage/async-storage&#39;;
import { authAPI } from &#39;../services/api&#39;;

const AuthContext = createContext();

export const useAuth = () =&gt; useContext(AuthContext);

export const AuthProvider = ({ children }) =&gt; {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() =&gt; {
    checkAuthStatus();
  }, []);

  const checkAuthStatus = async () =&gt; {
    try {
      const storedUser = await AsyncStorage.getItem(&#39;user&#39;);
      const accessToken = await AsyncStorage.getItem(&#39;accessToken&#39;);

      if (storedUser &amp;&amp; accessToken) {
        setUser(JSON.parse(storedUser));
      }
    } catch (error) {
      console.error(&#39;Auth check failed:&#39;, error);
    } finally {
      setLoading(false);
    }
  };

  const login = async (email, password) =&gt; {
    const response = await authAPI.login(email, password);
    setUser(response.data.user);
    return response;
  };

  const logout = async () =&gt; {
    await authAPI.logout();
    setUser(null);
  };

  return (
    &lt;AuthContext.Provider value={{ user, loading, login, logout, isAuthenticated: !!user }}&gt;
      {children}
    &lt;/AuthContext.Provider&gt;
  );
};
</code></pre>
<hr>
<h2 id="heading-11">Best Practices</h2><h3 id="heading-12">16. Security Best Practices</h3><h4 id="heading-13">Environment Variables</h4><pre><code class="language-bash"># Never commit these to version control!
NODE_ENV=production
DB_HOST=your-db-host
DB_USER=your-db-user
DB_PASSWORD=strong-password-here
JWT_ACCESS_SECRET=minimum-32-characters-random-string-abc123xyz789
JWT_REFRESH_SECRET=different-32-characters-random-string-def456uvw012
</code></pre>
<h4 id="heading-14">HTTPS Enforcement</h4><pre><code class="language-javascript">// In production, force HTTPS
app.use((req, res, next) =&gt; {
  if (process.env.NODE_ENV === &#39;production&#39; &amp;&amp; req.header(&#39;x-forwarded-proto&#39;) !== &#39;https&#39;) {
    res.redirect(`https://${req.header(&#39;host&#39;)}${req.url}`);
  } else {
    next();
  }
});
</code></pre>
<h4 id="heading-15">Rate Limiting Per Route</h4><pre><code class="language-javascript">const rateLimit = require(&#39;express-rate-limit&#39;);

// Stricter rate limit for transaction creation
const transactionLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 50, // 50 requests per window
  message: &#39;Too many transactions created, please try again later&#39;
});

router.post(&#39;/&#39;, transactionLimiter, async (req, res) =&gt; {
  // Transaction creation logic
});
</code></pre>
<h3 id="heading-16">17. Error Handling Middleware</h3><pre><code class="language-javascript">// src/middleware/errorHandler.js
function errorHandler(err, req, res, next) {
  console.error(&#39;Error:&#39;, {
    message: err.message,
    stack: process.env.NODE_ENV === &#39;development&#39; ? err.stack : undefined,
    path: req.path,
    method: req.method,
    userId: req.user?.userId
  });

  // Database errors
  if (err.code === &#39;ER_DUP_ENTRY&#39;) {
    return res.status(409).json({
      success: false,
      error: &#39;Duplicate entry&#39;
    });
  }

  if (err.code === &#39;ER_NO_REFERENCED_ROW_2&#39;) {
    return res.status(400).json({
      success: false,
      error: &#39;Referenced record not found&#39;
    });
  }

  // Validation errors
  if (err.name === &#39;ValidationError&#39;) {
    return res.status(400).json({
      success: false,
      error: err.message
    });
  }

  // Default error
  res.status(err.status || 500).json({
    success: false,
    error: process.env.NODE_ENV === &#39;production&#39; 
      ? &#39;Internal server error&#39; 
      : err.message
  });
}

module.exports = errorHandler;
</code></pre>
<h3 id="heading-17">18. Input Validation Utility</h3><pre><code class="language-javascript">// src/utils/validation.js
const validator = require(&#39;validator&#39;);

function validateTransaction(data) {
  const errors = [];

  if (!data.accountId || !Number.isInteger(data.accountId)) {
    errors.push(&#39;Valid accountId is required&#39;);
  }

  if (!data.categoryId || !Number.isInteger(data.categoryId)) {
    errors.push(&#39;Valid categoryId is required&#39;);
  }

  if (!data.amount || isNaN(parseFloat(data.amount)) || parseFloat(data.amount) &lt;= 0) {
    errors.push(&#39;Valid positive amount is required&#39;);
  }

  if (!data.type || ![&#39;income&#39;, &#39;expense&#39;, &#39;transfer&#39;].includes(data.type)) {
    errors.push(&#39;Type must be income, expense, or transfer&#39;);
  }

  if (!data.transactionDate || !validator.isDate(data.transactionDate)) {
    errors.push(&#39;Valid transaction date is required (YYYY-MM-DD)&#39;);
  }

  if (data.description &amp;&amp; data.description.length &gt; 500) {
    errors.push(&#39;Description must be less than 500 characters&#39;);
  }

  return errors;
}

function validateBudget(data) {
  const errors = [];

  if (!data.categoryId || !Number.isInteger(data.categoryId)) {
    errors.push(&#39;Valid categoryId is required&#39;);
  }

  if (!data.amount || isNaN(parseFloat(data.amount)) || parseFloat(data.amount) &lt;= 0) {
    errors.push(&#39;Valid positive amount is required&#39;);
  }

  if (!data.period || ![&#39;daily&#39;, &#39;weekly&#39;, &#39;monthly&#39;, &#39;yearly&#39;].includes(data.period)) {
    errors.push(&#39;Period must be daily, weekly, monthly, or yearly&#39;);
  }

  if (!data.startDate || !validator.isDate(data.startDate)) {
    errors.push(&#39;Valid start date is required (YYYY-MM-DD)&#39;);
  }

  if (data.endDate &amp;&amp; !validator.isDate(data.endDate)) {
    errors.push(&#39;End date must be a valid date (YYYY-MM-DD)&#39;);
  }

  if (data.alertThreshold &amp;&amp; (data.alertThreshold &lt; 0 || data.alertThreshold &gt; 100)) {
    errors.push(&#39;Alert threshold must be between 0 and 100&#39;);
  }

  return errors;
}

module.exports = {
  validateTransaction,
  validateBudget
};
</code></pre>
<h3 id="heading-18">19. Database Backup Script</h3><pre><code class="language-javascript">// scripts/backup.js
const { exec } = require(&#39;child_process&#39;);
const path = require(&#39;path&#39;);
const fs = require(&#39;fs&#39;);
require(&#39;dotenv&#39;).config();

const backupDir = path.join(__dirname, &#39;../backups&#39;);

// Create backups directory if it doesn&#39;t exist
if (!fs.existsSync(backupDir)) {
  fs.mkdirSync(backupDir, { recursive: true });
}

const timestamp = new Date().toISOString().replace(/[:.]/g, &#39;-&#39;);
const backupFile = path.join(backupDir, `backup-${timestamp}.sql`);

const command = `mysqldump -h ${process.env.DB_HOST} -u ${process.env.DB_USER} -p${process.env.DB_PASSWORD} ${process.env.DB_NAME} &gt; ${backupFile}`;

exec(command, (error, stdout, stderr) =&gt; {
  if (error) {
    console.error(&#39;Backup failed:&#39;, error);
    return;
  }
  
  console.log(`✓ Database backed up to: ${backupFile}`);
  
  // Delete backups older than 30 days
  const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
  
  fs.readdir(backupDir, (err, files) =&gt; {
    if (err) return;
    
    files.forEach(file =&gt; {
      const filePath = path.join(backupDir, file);
      const stats = fs.statSync(filePath);
      
      if (stats.mtimeMs &lt; thirtyDaysAgo) {
        fs.unlinkSync(filePath);
        console.log(`✓ Deleted old backup: ${file}`);
      }
    });
  });
});
</code></pre>
<p>Add to package.json:</p>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;backup&quot;: &quot;node scripts/backup.js&quot;
  }
}
</code></pre>
<h3 id="heading-19">20. Performance Monitoring</h3><pre><code class="language-javascript">// src/middleware/performanceMonitor.js
function performanceMonitor(req, res, next) {
  const start = Date.now();
  
  // Capture response
  const originalSend = res.json;
  
  res.json = function(data) {
    const duration = Date.now() - start;
    
    // Log slow requests (&gt;1 second)
    if (duration &gt; 1000) {
      console.warn(&#39;Slow request:&#39;, {
        method: req.method,
        path: req.path,
        duration: `${duration}ms`,
        userId: req.user?.userId
      });
    }
    
    // Add performance header
    res.set(&#39;X-Response-Time&#39;, `${duration}ms`);
    
    return originalSend.call(this, data);
  };
  
  next();
}

module.exports = performanceMonitor;
</code></pre>
<hr>
<h2 id="heading-20">Deployment Checklist</h2><h3 id="heading-21">Production Environment</h3><ul>
<li><input disabled="" type="checkbox"> Environment variables configured (DB, JWT secrets)</li>
<li><input disabled="" type="checkbox"> HTTPS enabled and enforced</li>
<li><input disabled="" type="checkbox"> Database backups scheduled (daily)</li>
<li><input disabled="" type="checkbox"> Security headers configured (Helmet)</li>
<li><input disabled="" type="checkbox"> CORS properly configured (specific origins)</li>
<li><input disabled="" type="checkbox"> Rate limiting enabled on all routes</li>
<li><input disabled="" type="checkbox"> Error logging service configured (Sentry, LogRocket)</li>
<li><input disabled="" type="checkbox"> Database connection pooling optimized</li>
<li><input disabled="" type="checkbox"> Audit logging to external service</li>
<li><input disabled="" type="checkbox"> Monitoring and alerting setup (CloudWatch, Datadog)</li>
<li><input disabled="" type="checkbox"> Load balancer configured (if multiple instances)</li>
<li><input disabled="" type="checkbox"> Database read replicas (if high traffic)</li>
<li><input disabled="" type="checkbox"> CDN for static assets (if any)</li>
<li><input disabled="" type="checkbox"> Regular security updates scheduled</li>
<li><input disabled="" type="checkbox"> Penetration testing completed</li>
<li><input disabled="" type="checkbox"> Documentation updated</li>
<li><input disabled="" type="checkbox"> Disaster recovery plan documented</li>
</ul>
<hr>
<h2 id="heading-22">Summary</h2><p>You now have a complete guide for building headless applications with SecureNodeAuth! The income/expense tracker example demonstrates:</p>
<p>✅ <strong>Authentication Layer</strong>: SecureNodeAuth handles users, sessions, tokens<br>✅ <strong>Complex Database Schema</strong>: Multiple related tables with foreign keys<br>✅ <strong>RESTful API</strong>: Full CRUD operations for all resources<br>✅ <strong>Data Isolation</strong>: Each user only accesses their own data<br>✅ <strong>Transaction Safety</strong>: Database transactions for complex operations<br>✅ <strong>Real-time Features</strong>: Budget alerts, recurring transactions<br>✅ <strong>Multi-platform</strong>: Web (React) and Mobile (React Native)<br>✅ <strong>Production Ready</strong>: Security, monitoring, backups, error handling  </p>
<p><strong>Key Takeaway</strong>: SecureNodeAuth provides the authentication foundation, allowing you to focus on building your application&#39;s unique features and business logic!</p>
</div>

        <!-- Navigation Buttons -->
        <div id="doc-navigation" class="mt-12 pt-8 border-t-2 border-gray-800"><div class="flex flex-col sm:flex-row justify-between gap-4">
      <a href="HEADLESS_APPS_GUIDE_PART2.html" class="nav-button-outline">
        <i class="fas fa-arrow-left"></i>
        <span>Headless Apps (Part 2)</span>
      </a>
      <a href="HEADLESS_APPS_INDEX.html" class="nav-button">
        <span>Headless Apps Index</span>
        <i class="fas fa-arrow-right"></i>
      </a></div></div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="../js/static-docs.js"></script>
  </body>
</html>
